# Comparing `tmp/odoo14_addon_invader_payment_adyen-14.0.1.0.2-py3-none-any.whl.zip` & `tmp/odoo14_addon_invader_payment_adyen-14.0.1.0.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,28 @@
-Zip file size: 33642 bytes, number of entries: 24
--rw-r--r--  2.0 unx     4820 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/README.rst
--rw-r--r--  2.0 unx       44 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/__init__.py
--rw-r--r--  2.0 unx      680 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/__manifest__.py
--rw-r--r--  2.0 unx      353 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/data/decimal_precision.xml
--rw-r--r--  2.0 unx     3669 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/i18n/invader_payment_adyen.pot
--rw-r--r--  2.0 unx       95 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/models/__init__.py
--rw-r--r--  2.0 unx      814 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/models/invader_payable.py
--rw-r--r--  2.0 unx     5866 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/models/payment_acquirer.py
--rw-r--r--  2.0 unx      290 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/models/payment_transaction.py
--rw-r--r--  2.0 unx       98 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx       42 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       57 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/readme/HISTORY.rst
--rw-r--r--  2.0 unx     2495 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/readme/USAGE.rst
--rw-r--r--  2.0 unx       53 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/services/__init__.py
--rw-r--r--  2.0 unx      325 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/services/exceptions.py
--rw-r--r--  2.0 unx    18827 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/services/payment_adyen.py
--rw-r--r--  2.0 unx     9455 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/static/description/icon.png
--rw-r--r--  2.0 unx    17310 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/static/description/index.html
--rw-r--r--  2.0 unx      970 b- defN 23-Jun-15 15:16 odoo/addons/invader_payment_adyen/views/payment_acquirer.xml
--rw-r--r--  2.0 unx     5576 b- defN 23-Jun-15 15:17 odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-15 15:17 odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jun-15 15:17 odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2664 b- defN 23-Jun-15 15:17 odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/RECORD
-24 files, 74600 bytes uncompressed, 29048 bytes compressed:  61.1%
+Zip file size: 35744 bytes, number of entries: 26
+-rw-r--r--  2.0 unx     4868 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/README.rst
+-rw-r--r--  2.0 unx       44 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/__init__.py
+-rw-r--r--  2.0 unx      721 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/__manifest__.py
+-rw-r--r--  2.0 unx      353 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/data/decimal_precision.xml
+-rw-r--r--  2.0 unx     4072 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/i18n/invader_payment_adyen.pot
+-rw-r--r--  2.0 unx       95 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/models/__init__.py
+-rw-r--r--  2.0 unx      814 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/models/invader_payable.py
+-rw-r--r--  2.0 unx     5923 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/models/payment_acquirer.py
+-rw-r--r--  2.0 unx     3742 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/models/payment_transaction.py
+-rw-r--r--  2.0 unx       98 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx       90 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       57 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/readme/HISTORY.rst
+-rw-r--r--  2.0 unx     2495 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/readme/USAGE.rst
+-rw-r--r--  2.0 unx       83 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/services/__init__.py
+-rw-r--r--  2.0 unx      325 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/services/exceptions.py
+-rw-r--r--  2.0 unx      433 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/services/invader_payment.py
+-rw-r--r--  2.0 unx    19573 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/services/payment_adyen.py
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/static/description/icon.png
+-rw-r--r--  2.0 unx    17453 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/static/description/index.html
+-rw-r--r--  2.0 unx      683 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/views/payment_acquirer.xml
+-rw-r--r--  2.0 unx     2098 b- defN 23-Jun-16 10:01 odoo/addons/invader_payment_adyen/views/payment_transaction.xml
+-rw-r--r--  2.0 unx     5624 b- defN 23-Jun-16 10:01 odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-16 10:01 odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jun-16 10:01 odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2902 b- defN 23-Jun-16 10:01 odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/RECORD
+26 files, 82098 bytes uncompressed, 30750 bytes compressed:  62.5%
```

## zipnote {}

```diff
@@ -42,32 +42,38 @@
 
 Filename: odoo/addons/invader_payment_adyen/services/__init__.py
 Comment: 
 
 Filename: odoo/addons/invader_payment_adyen/services/exceptions.py
 Comment: 
 
+Filename: odoo/addons/invader_payment_adyen/services/invader_payment.py
+Comment: 
+
 Filename: odoo/addons/invader_payment_adyen/services/payment_adyen.py
 Comment: 
 
 Filename: odoo/addons/invader_payment_adyen/static/description/icon.png
 Comment: 
 
 Filename: odoo/addons/invader_payment_adyen/static/description/index.html
 Comment: 
 
 Filename: odoo/addons/invader_payment_adyen/views/payment_acquirer.xml
 Comment: 
 
-Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/METADATA
+Filename: odoo/addons/invader_payment_adyen/views/payment_transaction.xml
+Comment: 
+
+Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/WHEEL
+Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/top_level.txt
+Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/RECORD
+Filename: odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/invader_payment_adyen/README.rst

```diff
@@ -153,14 +153,15 @@
 
 * ACSONE SA/NV
 
 Contributors
 ~~~~~~~~~~~~
 
 * Denis Roussel <denis.roussel@acsone.eu>
+* François Honoré <francois.honore@acsone.eu>
 
 Maintainers
 ~~~~~~~~~~~
 
 .. |maintainer-rousseldenis| image:: https://github.com/rousseldenis.png?size=40px
     :target: https://github.com/rousseldenis
     :alt: rousseldenis
```

### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

## odoo/addons/invader_payment_adyen/__manifest__.py

```diff
@@ -1,19 +1,20 @@
 # Copyright 2019 ACSONE SA/NV
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "Invader Payment Adyen",
     "summary": """
         Adds a new payment service for Adyen""",
-    "version": "14.0.1.0.2",
+    "version": "14.0.1.0.3",
     "license": "AGPL-3",
     "author": "ACSONE SA/NV,Odoo Community Association (OCA)",
     "website": "https://github.com/shopinvader/odoo-shopinvader-payment",
     "depends": ["invader_payment", "payment_adyen_paybylink", "base_rest"],
     "maintainers": ["rousseldenis"],
     "data": [
         "data/decimal_precision.xml",
         "views/payment_acquirer.xml",
+        "views/payment_transaction.xml",
     ],
     "external_dependencies": {"python": ["cerberus", "Adyen"], "bin": []},
 }
```

## odoo/addons/invader_payment_adyen/i18n/invader_payment_adyen.pot

```diff
@@ -15,43 +15,54 @@
 
 #. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_acquirer__adyen_api_key
 msgid "API Key"
 msgstr ""
 
 #. module: invader_payment_adyen
+#: model:ir.model,name:invader_payment_adyen.model_invader_payable
+msgid "Adyen Klarna capture Mixin"
+msgstr ""
+
+#. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_acquirer__adyen_live_endpoint_prefix
 msgid "Adyen Live Endpoint Prefix"
 msgstr ""
 
 #. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_transaction__adyen_payment_data
 msgid "Adyen Payment Data"
 msgstr ""
 
 #. module: invader_payment_adyen
+#: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_transaction__adyen_payment_method
+#: model_terms:ir.ui.view,arch_db:invader_payment_adyen.payment_transaction_search_view
+msgid "Adyen Payment Method"
+msgstr ""
+
+#. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_invader_payable__display_name
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_acquirer__display_name
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_transaction__display_name
 msgid "Display Name"
 msgstr ""
 
 #. module: invader_payment_adyen
+#: model_terms:ir.ui.view,arch_db:invader_payment_adyen.payment_transaction_search_view
+msgid "Group By"
+msgstr ""
+
+#. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_invader_payable__id
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_acquirer__id
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_transaction__id
 msgid "ID"
 msgstr ""
 
 #. module: invader_payment_adyen
-#: model:ir.model,name:invader_payment_adyen.model_invader_payable
-msgid "Interface for payable objects (e.g. cart, ...)"
-msgstr ""
-
-#. module: invader_payment_adyen
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_invader_payable____last_update
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_acquirer____last_update
 #: model:ir.model.fields,field_description:invader_payment_adyen.field_payment_transaction____last_update
 msgid "Last Modified on"
 msgstr ""
 
 #. module: invader_payment_adyen
```

## odoo/addons/invader_payment_adyen/models/payment_acquirer.py

```diff
@@ -19,48 +19,49 @@
         groups="base.group_user",
         help="You need to fill this in when switching to live environment. "
         "See: https://docs.adyen.com/development-resources/"
         "live-endpoints#set-up-live-endpoints",
     )
 
     def _get_adyen_notification_message(self, transaction, notification_item):
-        message = transaction.state_message
-        notification_message = (
-            "eventCode: {}, merchantReference: {}, pspReference: {}".format(
-                notification_item.get("eventCode"),
-                notification_item.get("merchantReference"),
-                notification_item.get("pspReference"),
-            )
-        )
-        stamp = str(fields.Datetime.now())
-        adyen_message = "\n" + stamp + ": " + str(notification_message)
-        if message:
-            message += adyen_message
-        else:
-            message = adyen_message
-        return message
+        # Keep the function for backward compatibility
+        return transaction._get_adyen_notification_message(notification_item)
 
     def _get_adyen_additional_data(self, transaction, notification_item):
         """Allows to update transaction details with additional data
         comming from Adyen.
 
         :param transaction: [description]
         :type transaction: [type]
         :param notification_item: [description]
         :type notification_item: [type]
         """
         vals = {}
-        message = self._get_adyen_notification_message(
-            transaction, notification_item
+        message = transaction._get_adyen_notification_message(
+            notification_item
         )
         vals.update({"state_message": message})
         if not transaction.acquirer_reference:
             vals.update(
                 {"acquirer_reference": notification_item.get("pspReference")}
             )
+        if transaction.acquirer_id.provider == "adyen":
+            payment_method = False
+            if notification_item.get("action"):
+                payment_method = notification_item.get("action")
+                if isinstance(payment_method, dict):
+                    payment_method = payment_method.get("paymentMethodType")
+            if notification_item.get("paymentMethod"):
+                payment_method = notification_item.get("paymentMethod")
+                if isinstance(payment_method, dict):
+                    payment_method = payment_method.get(
+                        "brand"
+                    ) or payment_method.get("type")
+            if payment_method:
+                vals.update({"adyen_payment_method": payment_method})
         return vals
 
     def _handle_adyen_notification_item(self, notification_item):
         """
         https://docs.adyen.com/development-resources/notifications/
         verify-hmac-signatures#example
         Look for a transaction with acquirer_reference == pspReference
@@ -80,17 +81,14 @@
         # You have to add notification configuration in Adyen backend for
         # shopperInteraction (Include Shopper Interaction)
         if addionalData:
             shopperInteraction = addionalData.get("shopperInteraction")
             if shopperInteraction and shopperInteraction != "Ecommerce":
                 return
         event_code = notification_item.get("eventCode")
-        # TODO: Treat each event_code
-        if event_code != "AUTHORISATION":
-            return
         psp_reference = notification_item.get("pspReference")
         merchant_reference = notification_item.get("merchantReference")
         transaction = self.env["payment.transaction"].search(
             [("acquirer_reference", "=", psp_reference)]
         )
         if not transaction and merchant_reference:
             # If the transaction hasn't been validated but already created
@@ -120,23 +118,26 @@
             _logger.warning(message)
             raise AdyenInvalidData(message)
 
         data = self._get_adyen_additional_data(transaction, notification_item)
         if data:
             transaction.write(data)
         if event_code == "AUTHORISATION":
-            success = notification_item.get("success")
-            success = True if success == "true" else False
-            if success and transaction.state != "done":
-                # Set to done if not already. Don't raise, just pass
-                # It will return a 200 code to Adyen, so the webhook will
-                # be marked as done on their side.
-                transaction._set_transaction_done()
-            elif not success and transaction.state == "draft":
-                # Set to error if draft. Don't raise, just pass
-                # It will return a 200 code to Adyen, so the webhook will
-                # be marked as done on their side.
-                transaction._set_transaction_error(
-                    self._get_adyen_notification_message(
-                        transaction, notification_item
-                    )
-                )
+            transaction._handle_adyen_notification_item_authorized(
+                notification_item
+            )
+        elif event_code == "REFUND":
+            transaction._handle_adyen_notification_item_refund(
+                notification_item
+            )
+        elif event_code == "CANCELLATION":
+            transaction._handle_adyen_notification_item_cancel(
+                notification_item
+            )
+        elif event_code == "CAPTURE":
+            transaction._handle_adyen_notification_item_capture(
+                notification_item
+            )
+        elif event_code == "CAPTURE_FAILED":
+            transaction._handle_adyen_notification_item_capture_failed(
+                notification_item
+            )
```

## odoo/addons/invader_payment_adyen/models/payment_transaction.py

```diff
@@ -4,7 +4,93 @@
 from odoo import fields, models
 
 
 class PaymentTransaction(models.Model):
     _inherit = "payment.transaction"
 
     adyen_payment_data = fields.Char(groups="base.group_user")
+    adyen_payment_method = fields.Char()
+
+    def _get_adyen_notification_message(self, notification_item):
+        message = self.state_message
+        notification_message = (
+            "eventCode: {}, merchantReference: {}, pspReference: {}".format(
+                notification_item.get("eventCode"),
+                notification_item.get("merchantReference"),
+                notification_item.get("pspReference"),
+            )
+        )
+        stamp = str(fields.Datetime.now())
+        adyen_message = "\n" + stamp + ": " + str(notification_message)
+        if message:
+            message += adyen_message
+        else:
+            message = adyen_message
+        return message
+
+    def _get_platform(self):
+        """
+        For Adyen: return 'test' or 'live' depending on acquirer value
+        :return: str
+        """
+        if self.acquirer_id.provider == "adyen":
+            state = self.acquirer_id.state
+            return "test" if state in ("disabled", "test") else "live"
+        return super()._get_platform()
+
+    def _handle_adyen_notification_item_authorized(self, notification_item):
+        success = notification_item.get("success")
+        success = True if success == "true" else False
+        if success and self.state != "done" and self.state != "authorized":
+            # Set to done if not already. Don't raise, just pass
+            # It will return a 200 code to Adyen, so the webhook will
+            # be marked as done on their side.
+            self._set_transaction_done()
+        elif not success and self.state == "draft":
+            # Set to error if draft. Don't raise, just pass
+            # It will return a 200 code to Adyen, so the webhook will
+            # be marked as done on their side.
+            self._set_transaction_error(
+                self._get_adyen_notification_message(notification_item)
+            )
+
+    def _handle_adyen_notification_item_refund(self, notification_item):
+        self.write(
+            {
+                "state_message": self._get_adyen_notification_message(
+                    notification_item
+                ),
+            }
+        )
+
+    def _handle_adyen_notification_item_cancel(self, notification_item):
+        self.write(
+            {
+                "state_message": self._get_adyen_notification_message(
+                    notification_item
+                )
+            }
+        )
+        self._set_transaction_cancel()
+
+    def _handle_adyen_notification_item_capture(self, notification_item):
+        success = notification_item.get("success")
+        success = True if success == "true" else False
+        if success and self.state != "done":
+            # Set to done if not already. Don't raise, just pass
+            # It will return a 200 code to Adyen, so the webhook will
+            # be marked as done on their side.
+            self._set_transaction_done()
+        elif not success and self.state == "draft":
+            # Set to error if draft. Don't raise, just pass
+            # It will return a 200 code to Adyen, so the webhook will
+            # be marked as done on their side.
+            self._set_transaction_error(
+                self._get_adyen_notification_message(notification_item)
+            )
+
+    def _handle_adyen_notification_item_capture_failed(
+        self, notification_item
+    ):
+        self._set_transaction_error(
+            self._get_adyen_notification_message(notification_item)
+        )
```

## odoo/addons/invader_payment_adyen/readme/CONTRIBUTORS.rst

```diff
@@ -1 +1,2 @@
 * Denis Roussel <denis.roussel@acsone.eu>
+* François Honoré <francois.honore@acsone.eu>
```

### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

## odoo/addons/invader_payment_adyen/services/__init__.py

```diff
@@ -1,2 +1,3 @@
+from . import invader_payment
 from . import payment_adyen
 from . import exceptions
```

## odoo/addons/invader_payment_adyen/services/payment_adyen.py

```diff
@@ -101,18 +101,17 @@
         )
         return adyen
 
     def _get_platform(self, transaction):
         """
         Return 'test' or 'live' depending on acquirer value
         :param transaction:
-        :return:
+        :return: str
         """
-        state = transaction.acquirer_id.state
-        return "test" if state in ("disabled", "test") else "live"
+        return transaction._get_platform()
 
     def _get_live_prefix(self, transaction):
         state = transaction.acquirer_id.state
         prefix = transaction.acquirer_id.adyen_live_endpoint_prefix
         return str(prefix) if state == "enabled" else ""
 
     def _validator_paymentMethods(self):
@@ -477,33 +476,49 @@
             lambda a: a.provider == "adyen"
         ).adyen_merchant_account
 
     def _update_additional_details(self, response):
         """
         Hook to be able to enrich transaction with response
         additionalData
-        :param vals:
-        :param response:
-        :return:
+        Payment result can contains payment method brand
         """
-        return {}
+        res = {}
+        if response.message.get("action", {}).get("paymentMethodType"):
+            payment_method = response.message.get("action", {}).get(
+                "paymentMethodType"
+            )
+            res.update({"adyen_payment_method": payment_method})
+        if response.message.get("paymentMethod", {}).get("type"):
+            payment_method = response.message.get("paymentMethod", {}).get(
+                "type"
+            )
+            res.update({"adyen_payment_method": payment_method})
+        if response.message.get("paymentMethod", {}).get("brand"):
+            payment_method = response.message.get("paymentMethod", {}).get(
+                "brand"
+            )
+            res.update({"adyen_payment_method": payment_method})
+        return res
 
     def _update_transaction_with_response(self, transaction, response):
         """
         Update the transaction with Adyen response
         :param transaction: payment.transaction
         :param response: AdyenResult
         :return:
         """
         vals = {}
         vals.update(self._update_additional_details(response))
         payment_data = response.message.get("paymentData")
         if payment_data:
             vals.update({"adyen_payment_data": payment_data})
-        psp_reference = response.message.get("pspReference")
+        psp_reference = response.message.get("pspReference") or getattr(
+            response, "psp", ""
+        )
         if psp_reference:
             vals.update({"acquirer_reference": psp_reference})
         result_code = response.message.get("resultCode")
         if result_code:
             # Log resultCode of Adyen in transaction
             message = transaction.state_message
             stamp = str(fields.Datetime.now())
```

## odoo/addons/invader_payment_adyen/static/description/index.html

### odoo/addons/invader_payment_adyen/static/description/index.html

```diff
@@ -637,14 +637,19 @@
           </h2>
           <ul class="simple">
             <li>
               Denis Roussel &lt;
               <a class="reference external" href="mailto:denis.roussel@acsone.eu">denis.roussel@acsone.eu</a>
               &gt;
             </li>
+            <li>
+              François Honoré &lt;
+              <a class="reference external" href="mailto:francois.honore@acsone.eu">francois.honore@acsone.eu</a>
+              &gt;
+            </li>
           </ul>
         </div>
         <div class="section" id="maintainers">
           <h2>
             <a class="toc-backref" href="#id7">Maintainers</a>
           </h2>
           <p>Current maintainer:</p>
```

## odoo/addons/invader_payment_adyen/views/payment_acquirer.xml

### odoo/addons/invader_payment_adyen/views/payment_acquirer.xml

```diff
@@ -2,15 +2,12 @@
 <odoo>
   <record id="payment_acquirer_form_view" model="ir.ui.view">
     <field name="name">payment.acquirer.form (in invader_payment_adyen)</field>
     <field name="model">payment.acquirer</field>
     <field name="inherit_id" ref="payment_adyen.acquirer_form_adyen"/>
     <field name="arch" type="xml">
       <field name="adyen_merchant_account" position="after">
-        <group attrs="{'invisible': [('provider', '!=', 'adyen')]}">
-          <field name="adyen_api_key" attrs="{'required':[('provider', '=', 'adyen')]}"/>
-          <field name="adyen_live_endpoint_prefix" attrs="{'required':[('provider', '=', 'adyen'), ('state', '=', 'enabled')]}"/>
-        </group>
+        <field name="adyen_live_endpoint_prefix" attrs="{'required':[('provider', '=', 'adyen'), ('state', '=', 'enabled')]}"/>
       </field>
     </field>
   </record>
 </odoo>
```

## Comparing `odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/METADATA` & `odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-invader-payment-adyen
-Version: 14.0.1.0.2
+Version: 14.0.1.0.3
 Summary: Adds a new payment service for Adyen
 Home-page: https://github.com/shopinvader/odoo-shopinvader-payment
 Author: ACSONE SA/NV,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
@@ -174,14 +174,15 @@
 
 * ACSONE SA/NV
 
 Contributors
 ~~~~~~~~~~~~
 
 * Denis Roussel <denis.roussel@acsone.eu>
+* François Honoré <francois.honore@acsone.eu>
 
 Maintainers
 ~~~~~~~~~~~
 
 .. |maintainer-rousseldenis| image:: https://github.com/rousseldenis.png?size=40px
     :target: https://github.com/rousseldenis
     :alt: rousseldenis
```

### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

## Comparing `odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/RECORD` & `odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,24 +1,26 @@
-odoo/addons/invader_payment_adyen/README.rst,sha256=rR2leJDV7TFrj9mC8b1GF6_D_aKzWqihyZVWB1oPlyw,4820
+odoo/addons/invader_payment_adyen/README.rst,sha256=YIVPjSmjSwbp-iuMtF0xaX6N9zd6y81vmDwAWrh7ZME,4868
 odoo/addons/invader_payment_adyen/__init__.py,sha256=iLIJMqyxPGaW4AYYX_MffqzP1KjldI_YrtyUvckOAbc,44
-odoo/addons/invader_payment_adyen/__manifest__.py,sha256=9R97kWl-utDZDzKMHJDddNKJZyIUnsLkQ2QYjS9iw2k,680
+odoo/addons/invader_payment_adyen/__manifest__.py,sha256=2QSEvodEO1JkdcIUOL0MasVFCkogIoc8tdwtgW-Ce5Y,721
 odoo/addons/invader_payment_adyen/data/decimal_precision.xml,sha256=Atw8RN3S6Wte9w-N7sNrUuJ06UmSGYeVMIFrVRnPduQ,353
-odoo/addons/invader_payment_adyen/i18n/invader_payment_adyen.pot,sha256=D4SKYgVqxOFE6wb3W4Ww6TAcHftl1jIKdtJ27sJqH6U,3669
+odoo/addons/invader_payment_adyen/i18n/invader_payment_adyen.pot,sha256=abpjmUDiVcPnrXqHd6DSz0sPLADVvTlbIQkEbiJKcRw,4072
 odoo/addons/invader_payment_adyen/models/__init__.py,sha256=GBuXmERBfy35IPUoswNxUW6RY6rqYoiXbyx5n7P4jeA,95
 odoo/addons/invader_payment_adyen/models/invader_payable.py,sha256=MY08QEmINh1jfb5UPvDM3vKbzj7imgdLuGmA_6y-mdc,814
-odoo/addons/invader_payment_adyen/models/payment_acquirer.py,sha256=uUipGn1kyZqh-GVAl6NQIpksCaqblfrtTXDcbl-NbDk,5866
-odoo/addons/invader_payment_adyen/models/payment_transaction.py,sha256=vAifpNbWSjJFjur3hm6iA2BzzKzKfmjDVvbD0GKD_Yo,290
+odoo/addons/invader_payment_adyen/models/payment_acquirer.py,sha256=GaWs0-2u1bFCzA4pggwppHYWA7l4sxSwRrxsc_sAIN4,5923
+odoo/addons/invader_payment_adyen/models/payment_transaction.py,sha256=--AFgomFvR9e4W4PHMXiiOI9LjsjGaSRB-FDhzsp1Vs,3742
 odoo/addons/invader_payment_adyen/readme/CONFIGURE.rst,sha256=MKl1TOGxAVmGxlwBsHJcAysZucDmHiEdZz7zAPo055o,98
-odoo/addons/invader_payment_adyen/readme/CONTRIBUTORS.rst,sha256=XOvmvmWVvuDVPNluyCog8zXbQ0wLwHqru-igToeRxwU,42
+odoo/addons/invader_payment_adyen/readme/CONTRIBUTORS.rst,sha256=1nvoH1C3c4y2VhdPtFHEGSPnNcMicbqLOA8_5JL_ots,90
 odoo/addons/invader_payment_adyen/readme/DESCRIPTION.rst,sha256=VQDvQQpzI4_-unPs2B4x0JNsMiaRVbov_-9M7o9kUB8,57
 odoo/addons/invader_payment_adyen/readme/HISTORY.rst,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 odoo/addons/invader_payment_adyen/readme/USAGE.rst,sha256=B8LzFgb3tUsRYoOiSEn7H1ND99uaduf3qB-xOc-TIu4,2495
-odoo/addons/invader_payment_adyen/services/__init__.py,sha256=IAMvQkXKfgSOdfKXFTnJ6ZTuxuyixw2aWZ54rUynKUA,53
+odoo/addons/invader_payment_adyen/services/__init__.py,sha256=vxBetsijHHkLPb0QsNgtxLX7NuY45Z2bgVxcvpH-wW8,83
 odoo/addons/invader_payment_adyen/services/exceptions.py,sha256=usRkTC3zH3-i9SmL-yPupwSAvID87gBgcnWvXrtLH18,325
-odoo/addons/invader_payment_adyen/services/payment_adyen.py,sha256=OKC746Pn-P0Fdq57OQjls1hdw-7z7NlLKBkuPUdQ5jU,18827
+odoo/addons/invader_payment_adyen/services/invader_payment.py,sha256=47WgrYJSrjhzO_Prq2Tb-vPKJta_tq8hghCJ9139SBs,433
+odoo/addons/invader_payment_adyen/services/payment_adyen.py,sha256=OXiTfQL1ykXcft1g7N1XtciQPeMhTZzE_EeouJ8yrQU,19573
 odoo/addons/invader_payment_adyen/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/invader_payment_adyen/static/description/index.html,sha256=AFSk-ulkB-LoSFq71jgvQDgv1Mrfrcrox8AmdkF1PIM,17310
-odoo/addons/invader_payment_adyen/views/payment_acquirer.xml,sha256=N6XzC24i8VqkUvmggF16oMt35Z7Ra7vk2yLY5rCFVFk,970
-odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/METADATA,sha256=bMgKw79S5YicUwV_bvni964619bXa-vN703taD8GTfo,5576
-odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
-odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_invader_payment_adyen-14.0.1.0.2.dist-info/RECORD,,
+odoo/addons/invader_payment_adyen/static/description/index.html,sha256=HNtByCzduZv1764JyH0JW4VgRoVtBoUv3pfHe3iNVAM,17453
+odoo/addons/invader_payment_adyen/views/payment_acquirer.xml,sha256=xFG3mKdFW3hxoRTcjgGCw18eo3qbK1ztf1cazv8OOWE,683
+odoo/addons/invader_payment_adyen/views/payment_transaction.xml,sha256=ByxP0oILY-vKAj8WRTmni0n3TXJmPtbctjGS1Armcqg,2098
+odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/METADATA,sha256=-UwcndnyqPWDu6M1xyJVW_SClEKd9XMDYeLwvU97agI,5624
+odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
+odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_invader_payment_adyen-14.0.1.0.3.dist-info/RECORD,,
```

