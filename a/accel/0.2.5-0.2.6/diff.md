# Comparing `tmp/accel-0.2.5-py3-none-any.whl.zip` & `tmp/accel-0.2.6-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 65905 bytes, number of entries: 35
--rw-rw-rw-  2.0 fat      199 b- defN 23-Jun-11 01:18 accel/__init__.py
+Zip file size: 66218 bytes, number of entries: 35
+-rw-rw-rw-  2.0 fat      199 b- defN 23-Jun-16 08:58 accel/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 21-Jul-01 06:20 accel/__main__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-Apr-24 06:17 accel/base/__init__.py
 -rw-rw-rw-  2.0 fat    14485 b- defN 23-May-10 10:31 accel/base/atoms.py
 -rw-rw-rw-  2.0 fat     2514 b- defN 22-Aug-23 04:00 accel/base/box.py
 -rw-rw-rw-  2.0 fat    22882 b- defN 23-May-10 09:09 accel/base/boxcore.py
 -rw-rw-rw-  2.0 fat    10265 b- defN 22-Dec-13 04:06 accel/base/formats.py
--rw-rw-rw-  2.0 fat    84567 b- defN 23-Jun-11 01:15 accel/base/modeler.py
+-rw-rw-rw-  2.0 fat    86289 b- defN 23-Jun-16 08:29 accel/base/modeler.py
 -rw-rw-rw-  2.0 fat      830 b- defN 22-Aug-23 04:00 accel/base/selector.py
 -rw-rw-rw-  2.0 fat    13436 b- defN 23-Feb-05 06:09 accel/base/systems.py
 -rw-rw-rw-  2.0 fat     1290 b- defN 22-Aug-23 04:00 accel/base/tools.py
 -rw-rw-rw-  2.0 fat    17216 b- defN 22-Aug-23 04:00 accel/base/topology.py
 -rw-rw-rw-  2.0 fat      755 b- defN 22-May-11 09:47 accel/plugin/__init__.py
 -rw-rw-rw-  2.0 fat    31834 b- defN 23-Feb-05 05:59 accel/plugin/gaulib.py
 -rw-rw-rw-  2.0 fat    10488 b- defN 23-Feb-05 06:02 accel/plugin/maelib.py
@@ -25,13 +25,13 @@
 -rw-rw-rw-  2.0 fat     1519 b- defN 23-Feb-05 07:21 accel/util/dialogue.py
 -rw-rw-rw-  2.0 fat     7662 b- defN 22-Apr-24 05:35 accel/util/elements.pkl
 -rw-rw-rw-  2.0 fat      546 b- defN 22-Aug-23 04:00 accel/util/execmd.py
 -rw-rw-rw-  2.0 fat      687 b- defN 22-Aug-23 04:00 accel/util/filetype.py
 -rw-rw-rw-  2.0 fat     4073 b- defN 23-Feb-05 07:59 accel/util/log.py
 -rw-rw-rw-  2.0 fat     7508 b- defN 22-Nov-24 03:42 accel/util/logo32.png
 -rw-rw-rw-  2.0 fat     2978 b- defN 22-Aug-23 04:00 accel/util/matrix.py
--rw-rw-rw-  2.0 fat     1059 b- defN 23-Jun-11 01:18 accel-0.2.5.dist-info/LICENSE
--rw-rw-rw-  2.0 fat      515 b- defN 23-Jun-11 01:18 accel-0.2.5.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-11 01:18 accel-0.2.5.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        6 b- defN 23-Jun-11 01:18 accel-0.2.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     2706 b- defN 23-Jun-11 01:18 accel-0.2.5.dist-info/RECORD
-35 files, 260289 bytes uncompressed, 61671 bytes compressed:  76.3%
+-rw-rw-rw-  2.0 fat     1059 b- defN 23-Jun-16 08:58 accel-0.2.6.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat      515 b- defN 23-Jun-16 08:58 accel-0.2.6.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-16 08:58 accel-0.2.6.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        6 b- defN 23-Jun-16 08:58 accel-0.2.6.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     2706 b- defN 23-Jun-16 08:58 accel-0.2.6.dist-info/RECORD
+35 files, 262011 bytes uncompressed, 61984 bytes compressed:  76.3%
```

## zipnote {}

```diff
@@ -84,23 +84,23 @@
 
 Filename: accel/util/logo32.png
 Comment: 
 
 Filename: accel/util/matrix.py
 Comment: 
 
-Filename: accel-0.2.5.dist-info/LICENSE
+Filename: accel-0.2.6.dist-info/LICENSE
 Comment: 
 
-Filename: accel-0.2.5.dist-info/METADATA
+Filename: accel-0.2.6.dist-info/METADATA
 Comment: 
 
-Filename: accel-0.2.5.dist-info/WHEEL
+Filename: accel-0.2.6.dist-info/WHEEL
 Comment: 
 
-Filename: accel-0.2.5.dist-info/top_level.txt
+Filename: accel-0.2.6.dist-info/top_level.txt
 Comment: 
 
-Filename: accel-0.2.5.dist-info/RECORD
+Filename: accel-0.2.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## accel/__init__.py

```diff
@@ -1,7 +1,7 @@
-__version__ = "0.2.5"
+__version__ = "0.2.6"
 
 from accel.base.atoms import Atom, Atoms
 from accel.base.box import Box
 from accel.base.systems import System, Systems
 
 __all__ = ["Box", "System", "Atom", "Systems", "Atoms"]
```

## accel/base/modeler.py

```diff
@@ -1,7 +1,8 @@
+import itertools
 import math
 from collections import defaultdict, deque
 from collections.abc import MutableSequence
 from statistics import mean
 from typing import Iterable, Sequence
 
 import numpy as np
@@ -935,14 +936,39 @@
             min_invalid = invalid_atoms
         elif min_invalid == invalid_atoms:
             h_matched_canonical_initial_chains.append(chain)
 
     # for chain in h_matched_canonical_initial_chains:
     #     logger.debug(f"h_matched_canonical_initial_chains: {[(pr[0].number, pr[1].number) for pr in chain]}")
 
+    if (
+        len(h_matched_canonical_initial_chains) != 1
+        and max([len(chain) for chain in h_matched_canonical_initial_chains]) == 1
+    ):
+        logger.debug(f"generating combination_chains from {len(h_matched_canonical_initial_chains)} chains")
+        # for chain in h_matched_canonical_initial_chains:
+        #     logger.debug(f"original hmc_initial_chains: {[(pr[0].number, pr[1].number) for pr in chain]}")
+        sole_chains = [chain[0] for chain in h_matched_canonical_initial_chains]
+        max_combs: list[list[tuple[Atom]]] = []
+        for length in reversed(list(range(1, len(sole_chains) + 1))):
+            for comb in itertools.combinations(sole_chains, length):
+                if len({cb[0] for cb in comb}) != length:
+                    continue
+                if len({cb[1] for cb in comb}) != length:
+                    continue
+                max_combs.append(list(comb))
+            if len(max_combs) != 0:
+                break
+        if len(max_combs) == 0:
+            logger.debug("not found appropriate combination")
+        else:
+            h_matched_canonical_initial_chains = max_combs
+            # for chain in h_matched_canonical_initial_chains:
+            #     logger.debug(f"new hmc_initial_chains: {[(pr[0].number, pr[1].number) for pr in chain]}")
+
     def _det_ez(a: Atom, b: Atom, c: Atom, d: Atom) -> bool:
         vab = np.array(a.xyz) - np.array(b.xyz)
         vcb = np.array(c.xyz) - np.array(b.xyz)
         vdc = np.array(d.xyz) - np.array(c.xyz)
         pvac = np.cross(vab, vcb)
         pvbd = np.cross(vdc, vcb)
         angle = np.arccos(np.sum(pvac * pvbd) / (np.linalg.norm(pvac) * np.linalg.norm(pvbd)))
@@ -1177,15 +1203,20 @@
     for chain in canonical_recursive_extended_chains.values():
         logger.debug(f"canonical_recursive_extended_chains: {[(pr[0].number, pr[1].number) for pr in chain]}")
 
     return list(canonical_recursive_extended_chains.values())
 
 
 def _expand_maps(
-    atoms_a: "Atoms", atoms_b: "Atoms", atom_maps: list[list[tuple[Atom]]], max_loop: int = 3
+    atoms_a: "Atoms",
+    atoms_b: "Atoms",
+    atom_maps: list[list[tuple[Atom]]],
+    max_loop: int = 4,
+    max_different_bonds: int = 8,
+    max_loop_rest_que: int = 8192,
 ) -> list[list[tuple[Atom]]]:
     def ab_conv(atom: Atom, atom_map: list[tuple[Atom]]) -> Atom:
         try:
             idx = [pr[0] for pr in atom_map].index(atom)
         except ValueError:
             pass
         else:
@@ -1200,39 +1231,42 @@
 
     logger.debug(f"expanding {len(atom_maps)} chains")
     total_atom_maps_dict: dict[tuple[tuple[int]], list[tuple[Atom]]] = {}
     for atom_map in atom_maps:
         key = tuple(sorted([(mp[0].number, mp[1].number) for mp in atom_map], key=lambda t: t[0]))
         total_atom_maps_dict[key] = atom_map
     for initial_atom_map in atom_maps:
-        que_atom_maps = [initial_atom_map]
+        que_atom_maps = [(initial_atom_map, max_different_bonds)]
         loop_counter = 0
         while que_atom_maps:
-            atom_map = que_atom_maps.pop(0)
+            atom_map, max_diff_bonds = que_atom_maps.pop(0)
             potential_swaps: list[list[Atom]] = []
             a_diff_bonds: list[tuple[Atom]] = []
             for ab_map in atom_map:
                 for a_diff_bd in set([a for a in ab_map[0].bonds]) ^ set(
                     [ab_conv(b, atom_map) for b in ab_map[1].bonds]
                 ):
                     a_diff_bonds.append((ab_map[0], a_diff_bd))
             a_diff_bonds = list(set([tuple(sorted(adb, key=lambda a: a.number)) for adb in a_diff_bonds]))
             # logger.debug(f"a_diff_bonds: {[[a.number for a in adb] for adb in a_diff_bonds]}")
+            if len(a_diff_bonds) > max_diff_bonds:
+                # logger.debug(f"len(a_diff_bonds) exceeded last length {max_diff_bonds}")
+                continue
             loop_rest_que: list[dict] = [
                 {
                     "loop_atoms": (adb[0],),
                     "rest_bonds": [b for b in a_diff_bonds if b is not adb],
                     "end_atom": adb[1],
                 }
                 for adb in a_diff_bonds
             ]
             stored_loop_atoms = []
             while loop_rest_que:
-                if len(loop_rest_que) > 1024:
-                    logger.error("loop_rest_que reached 1024: exiting loop")
+                if len(loop_rest_que) > max_loop_rest_que:
+                    logger.error(f"loop_rest_que reached {max_loop_rest_que}: exiting loop")
                     break
                 q = loop_rest_que.pop(0)
                 loop_atoms: tuple[Atom] = q["loop_atoms"]
                 rest_bonds: list[tuple[Atom]] = q["rest_bonds"]
                 if loop_atoms[-1] is q["end_atom"]:
                     stored_loop_atoms.append(loop_atoms)
                     # logger.debug(f"loop_atoms: {[a.number for a in loop_atoms]}")
@@ -1256,16 +1290,17 @@
                     )
             for loop_atoms in stored_loop_atoms:
                 # logger.debug(f"loop_atoms: {[a.number for a in loop_atoms]}")
                 if len(set([a.symbol for a in loop_atoms[::2]])) == 1:
                     potential_swaps.append([a for a in loop_atoms[::2]])
                 if len(set([a.symbol for a in loop_atoms[1::2]])) == 1:
                     potential_swaps.append([a for a in loop_atoms[1::2]])
-            potential_swaps: list[tuple[Atom]] = list(
-                set([tuple(sorted(adb, key=lambda a: a.number)) for adb in potential_swaps])
+            potential_swaps: list[tuple[Atom]] = sorted(
+                list(set([tuple(sorted(adb, key=lambda a: a.number)) for adb in potential_swaps])),
+                key=lambda ap: ap[0].number,
             )
             # logger.debug(f"potential_swap: {[[a.number for a in pswap] for pswap in potential_swaps]}")
             atom_map_a = [m[0] for m in atom_map]
             for pq_swap in potential_swaps:
                 if len(pq_swap) != 2:
                     continue
                 try:
@@ -1276,15 +1311,15 @@
                     continue
                 new_map = atom_map[:]
                 new_map[p_id], new_map[q_id] = (pq_swap[0], new_map[q_id][1]), (pq_swap[1], new_map[p_id][1])
                 new_map_key = tuple(sorted([(mp[0].number, mp[1].number) for mp in new_map], key=lambda t: t[0]))
                 if new_map_key not in total_atom_maps_dict:
                     logger.info(f"expanded_chains: {[(pr[0].number, pr[1].number) for pr in new_map]}")
                     total_atom_maps_dict[new_map_key] = new_map
-                    que_atom_maps.append(new_map)
+                    que_atom_maps.append((new_map, len(a_diff_bonds)))
             loop_counter += 1
             if loop_counter >= max_loop:
                 break
     return list(total_atom_maps_dict.values())
 
 
 def _order_maps(atoms_a: "Atoms", atoms_b: "Atoms", atom_maps: list[list[tuple[Atom]]]) -> list[list[tuple[Atom]]]:
```

## Comparing `accel-0.2.5.dist-info/LICENSE` & `accel-0.2.6.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `accel-0.2.5.dist-info/METADATA` & `accel-0.2.6.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: accel
-Version: 0.2.5
+Version: 0.2.6
 Summary: automated computation chemical library specialized for handling large numbers of conformers
 Home-page: https://github.com/kfchem/accel
 Author: Keisuke Fukaya
 Author-email: kfukaya@pu-toyama.ac.jp
 License: MIT License
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `accel-0.2.5.dist-info/RECORD` & `accel-0.2.6.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,15 +1,15 @@
-accel/__init__.py,sha256=giIB-z8v_niZARiDq1N4haCevqjxWy1Ri4IOyY2KYPQ,199
+accel/__init__.py,sha256=jeyGTo7_S1gFBJrGWTzW5uSe5zxZ3bBi01FxS-5WM-A,199
 accel/__main__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 accel/base/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 accel/base/atoms.py,sha256=IuFFP7l7n8_FVDUI4Fx9mdsJHAXoVB9Aa_X-WwEQP0w,14485
 accel/base/box.py,sha256=5pka1-hA7-SeIG9HUI07V-xRFCWESShdcnziElCrv_E,2514
 accel/base/boxcore.py,sha256=b8Y9TNF4UWWFVtMDa3jxnp0J4KBGGK-YhprUTFYTjyE,22882
 accel/base/formats.py,sha256=xCzSv5_jRxCAoZYQLmXZDYKk-MajT4EQW_rkEK_ywE0,10265
-accel/base/modeler.py,sha256=slxrmnZiWBa9-I0lnsAtu1zZu3kdpHwe5E9SxcitcT4,84567
+accel/base/modeler.py,sha256=P036ibhknS07d8x0Tpn6O2i4LPApjWHtpkxX0nCzUAM,86289
 accel/base/selector.py,sha256=BZERAbMyb1KoqfBW1c1EC4WTBsKgsfFGQnEh105oQKg,830
 accel/base/systems.py,sha256=08px0f8bFeMwnpf9tOS6P7gYBecjToqmZNNFtMGPfus,13436
 accel/base/tools.py,sha256=O40JDiua5a0RzBBEl13BN_QvfJ_WdhDcuQsz96PLUV8,1290
 accel/base/topology.py,sha256=BNgDRvmcsZorU2l08eqq9tfd7yyMvvaeAyr-M_V9FHA,17216
 accel/plugin/__init__.py,sha256=vIESlj9VGQnUMOVXn6UZHBfGKz54JtsDgJoLUeWMP6M,755
 accel/plugin/gaulib.py,sha256=NRf41yAweIgZd4Rj1qmoOReR_YDrk96OuniqQKy7-qs,31834
 accel/plugin/maelib.py,sha256=wS2AvjW0rMZTquxlB8sdLODjg9-KSMFLf9dS3hOgT4I,10488
@@ -24,12 +24,12 @@
 accel/util/dialogue.py,sha256=-s65zXRnEOohyH7N1ZEhDG9Z9p8e1b_Inog_oPkiK4s,1519
 accel/util/elements.pkl,sha256=JsxWQoKC4IovYUqReMqkHIuU9ykIiWK_Jl7Lgl1lDOg,7662
 accel/util/execmd.py,sha256=kyqgnB2etvU7de3gXlWKmv7H-_GIVRih-Jkl50jK1-o,546
 accel/util/filetype.py,sha256=JKpyowreNB3_lch7fJVBTDwJnHt7XC2LTPpAykZwW-o,687
 accel/util/log.py,sha256=N0eJUOkKU1TiZWAFC9BTEbh7AqPbBTsD08Tufu-l_6M,4073
 accel/util/logo32.png,sha256=fX2pmSs70rTbXTuGlTvy6hqSHjZ4VejSxtZ7F2o6_Wk,7508
 accel/util/matrix.py,sha256=ln-YsbzuTBrGJh4R3YZekFDEV__pcZYyLc9enD0g3dY,2978
-accel-0.2.5.dist-info/LICENSE,sha256=6kVvPMd5fpiLN44G42XCWHb0Q_nDhLOMW1K4py7EY1I,1059
-accel-0.2.5.dist-info/METADATA,sha256=kROOK8WKvuqjN6qVEdv_QF1BoYJRjlLtd9JPZ8DWTOs,515
-accel-0.2.5.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-accel-0.2.5.dist-info/top_level.txt,sha256=rvhggDW-aRtU4KyyeMQ0SKa754UarbjRb4izBDCNj6g,6
-accel-0.2.5.dist-info/RECORD,,
+accel-0.2.6.dist-info/LICENSE,sha256=6kVvPMd5fpiLN44G42XCWHb0Q_nDhLOMW1K4py7EY1I,1059
+accel-0.2.6.dist-info/METADATA,sha256=EQq_za12L1c-yTyo4kOfq8JyEG-iPMhPBu-A1avLtho,515
+accel-0.2.6.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+accel-0.2.6.dist-info/top_level.txt,sha256=rvhggDW-aRtU4KyyeMQ0SKa754UarbjRb4izBDCNj6g,6
+accel-0.2.6.dist-info/RECORD,,
```

