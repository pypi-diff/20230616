# Comparing `tmp/NEMO_billing-2.4.0-py3-none-any.whl.zip` & `tmp/NEMO_billing-2.5.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,133 +1,149 @@
-Zip file size: 168278 bytes, number of entries: 131
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/__init__.py
--rw-r--r--  2.0 unx    14038 b- defN 23-Jun-04 23:42 NEMO_billing/admin.py
--rw-r--r--  2.0 unx     2638 b- defN 23-Jun-04 23:42 NEMO_billing/api.py
--rw-r--r--  2.0 unx      285 b- defN 23-Jun-04 23:42 NEMO_billing/app_settings.py
--rw-r--r--  2.0 unx      426 b- defN 23-Jun-04 23:42 NEMO_billing/apps.py
--rw-r--r--  2.0 unx      199 b- defN 23-Jun-04 23:42 NEMO_billing/decorators.py
--rw-r--r--  2.0 unx      122 b- defN 23-Jun-04 23:42 NEMO_billing/exceptions.py
--rw-r--r--  2.0 unx     5375 b- defN 23-Jun-04 23:42 NEMO_billing/models.py
--rw-r--r--  2.0 unx     1304 b- defN 23-Jun-04 23:42 NEMO_billing/urls.py
--rw-r--r--  2.0 unx      417 b- defN 23-Jun-04 23:42 NEMO_billing/utilities.py
--rw-r--r--  2.0 unx     6261 b- defN 23-Jun-04 23:42 NEMO_billing/views.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/__init__.py
--rw-r--r--  2.0 unx     6046 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/admin.py
--rw-r--r--  2.0 unx      102 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/app_settings.py
--rw-r--r--  2.0 unx      436 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/apps.py
--rw-r--r--  2.0 unx     2991 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/customization.py
--rw-r--r--  2.0 unx      892 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/exceptions.py
--rw-r--r--  2.0 unx    18242 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/models.py
--rw-r--r--  2.0 unx    20948 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/processors.py
--rw-r--r--  2.0 unx      461 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/urls.py
--rw-r--r--  2.0 unx     1280 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/views.py
--rw-r--r--  2.0 unx     7568 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/migrations/0001_initial.py
--rw-r--r--  2.0 unx     1665 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py
--rw-r--r--  2.0 unx     4815 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py
--rw-r--r--  2.0 unx     3478 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/migrations/__init__.py
--rw-rw-rw-  2.0 unx     1664 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html
--rw-rw-rw-  2.0 unx     4068 b- defN 23-Jun-04 23:42 NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/__init__.py
--rw-r--r--  2.0 unx    10561 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/admin.py
--rw-r--r--  2.0 unx     7049 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/api.py
--rw-r--r--  2.0 unx      176 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/app_settings.py
--rw-r--r--  2.0 unx      437 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/apps.py
--rw-r--r--  2.0 unx     4448 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/customization.py
--rw-r--r--  2.0 unx     2642 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/exceptions.py
--rw-r--r--  2.0 unx    23292 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/models.py
--rw-r--r--  2.0 unx    12477 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/pdf_utilities.py
--rw-r--r--  2.0 unx    28706 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/processors.py
--rw-r--r--  2.0 unx    25415 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/renderers.py
--rw-r--r--  2.0 unx     2937 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/urls.py
--rw-r--r--  2.0 unx     4235 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/utilities.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/management/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/management/commands/__init__.py
--rw-r--r--  2.0 unx      298 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py
--rw-r--r--  2.0 unx      318 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py
--rw-r--r--  2.0 unx     9795 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0001_initial.py
--rw-r--r--  2.0 unx     2781 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0002_version_1_2_0.py
--rw-r--r--  2.0 unx     1063 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0003_version_1_4_0.py
--rw-r--r--  2.0 unx      467 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0004_version_1_6_0.py
--rw-r--r--  2.0 unx      485 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0005_version_1_6_1.py
--rw-r--r--  2.0 unx      518 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0006_version_1_7_1.py
--rw-r--r--  2.0 unx      458 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0007_version_1_8_0.py
--rw-r--r--  2.0 unx      437 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0008_version_1_10_0.py
--rw-r--r--  2.0 unx     1183 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0009_version_1_23_0.py
--rw-r--r--  2.0 unx      439 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0010_version_2_0_0.py
--rw-r--r--  2.0 unx     1280 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/0011_version_2_4_0.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/migrations/__init__.py
--rw-rw-rw-  2.0 unx     1030 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/static/invoices/invoices.css
--rw-rw-rw-  2.0 unx     5678 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/customizations/customizations_billing.html
--rw-rw-rw-  2.0 unx     8157 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/customizations/customizations_invoices.html
--rw-rw-rw-  2.0 unx      212 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/base.html
--rw-rw-rw-  2.0 unx    12867 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/invoice.html
--rw-rw-rw-  2.0 unx     3375 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/invoice_details.html
--rw-rw-rw-  2.0 unx    12238 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/invoices.html
--rw-rw-rw-  2.0 unx    13787 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/usage.html
--rw-rw-rw-  2.0 unx     1274 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html
--rw-rw-rw-  2.0 unx      173 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt
--rw-rw-rw-  2.0 unx     1330 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html
--rw-rw-rw-  2.0 unx     1344 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html
--rw-rw-rw-  2.0 unx      155 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt
--rw-rw-rw-  2.0 unx      155 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt
--rw-rw-rw-  2.0 unx    13693 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/project/edit_project.html
--rw-rw-rw-  2.0 unx     3668 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/views/__init__.py
--rw-r--r--  2.0 unx    18829 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/views/invoices.py
--rw-r--r--  2.0 unx     6929 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/views/project.py
--rw-r--r--  2.0 unx    10654 b- defN 23-Jun-04 23:42 NEMO_billing/invoices/views/usage.py
--rw-r--r--  2.0 unx     3156 b- defN 23-Jun-04 23:42 NEMO_billing/migrations/0001_initial.py
--rw-r--r--  2.0 unx      573 b- defN 23-Jun-04 23:42 NEMO_billing/migrations/0002_version_1_2_0.py
--rw-r--r--  2.0 unx      466 b- defN 23-Jun-04 23:42 NEMO_billing/migrations/0003_version_2_0_0.py
--rw-r--r--  2.0 unx     7722 b- defN 23-Jun-04 23:42 NEMO_billing/migrations/0004_version_2_4_0.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/migrations/__init__.py
--rw-r--r--  2.0 unx        1 b- defN 23-Jun-04 23:42 NEMO_billing/rates/__init__.py
--rw-r--r--  2.0 unx     8271 b- defN 23-Jun-04 23:42 NEMO_billing/rates/admin.py
--rw-r--r--  2.0 unx     2318 b- defN 23-Jun-04 23:42 NEMO_billing/rates/api.py
--rw-r--r--  2.0 unx      100 b- defN 23-Jun-04 23:42 NEMO_billing/rates/app_settings.py
--rw-r--r--  2.0 unx      707 b- defN 23-Jun-04 23:42 NEMO_billing/rates/apps.py
--rw-r--r--  2.0 unx      520 b- defN 23-Jun-04 23:42 NEMO_billing/rates/customization.py
--rw-r--r--  2.0 unx     1913 b- defN 23-Jun-04 23:42 NEMO_billing/rates/model_diff.py
--rw-r--r--  2.0 unx    22892 b- defN 23-Jun-04 23:42 NEMO_billing/rates/models.py
--rw-r--r--  2.0 unx     4042 b- defN 23-Jun-04 23:42 NEMO_billing/rates/rates_class.py
--rw-r--r--  2.0 unx      838 b- defN 23-Jun-04 23:42 NEMO_billing/rates/urls.py
--rw-r--r--  2.0 unx    12483 b- defN 23-Jun-04 23:42 NEMO_billing/rates/views.py
--rw-r--r--  2.0 unx     5101 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/0001_initial.py
--rw-r--r--  2.0 unx      602 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/0002_version_1_15_0.py
--rw-r--r--  2.0 unx     1999 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/0003_version_1_17_0.py
--rw-r--r--  2.0 unx      421 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/0004_version_2_0_0.py
--rw-r--r--  2.0 unx      448 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/0005_version_2_3_0.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/rates/migrations/__init__.py
--rw-rw-rw-  2.0 unx       81 b- defN 23-Jun-04 23:42 NEMO_billing/rates/static/rates/rates.css
--rw-rw-rw-  2.0 unx     1808 b- defN 23-Jun-04 23:42 NEMO_billing/rates/templates/customizations/customizations_billing_rates.html
--rw-rw-rw-  2.0 unx      160 b- defN 23-Jun-04 23:42 NEMO_billing/rates/templates/rates/base.html
--rw-rw-rw-  2.0 unx     6047 b- defN 23-Jun-04 23:42 NEMO_billing/rates/templates/rates/rate.html
--rw-rw-rw-  2.0 unx     5591 b- defN 23-Jun-04 23:42 NEMO_billing/rates/templates/rates/rate_form_details.html
--rw-rw-rw-  2.0 unx     4602 b- defN 23-Jun-04 23:42 NEMO_billing/rates/templates/rates/rates.html
--rw-rw-rw-  2.0 unx      192 b- defN 23-Jun-04 23:42 NEMO_billing/templates/base/navbar.html
--rw-rw-rw-  2.0 unx      461 b- defN 23-Jun-04 23:42 NEMO_billing/templates/base/navbar_billing.html
--rw-rw-rw-  2.0 unx     8882 b- defN 23-Jun-04 23:42 NEMO_billing/templates/billing/custom_charge.html
--rw-rw-rw-  2.0 unx     2074 b- defN 23-Jun-04 23:42 NEMO_billing/templates/billing/custom_charges.html
--rw-rw-rw-  2.0 unx     1259 b- defN 23-Jun-04 23:42 NEMO_billing/templates/staff_charges/choose_project.html
--rw-rw-rw-  2.0 unx     1979 b- defN 23-Jun-04 23:42 NEMO_billing/templates/staff_charges/new_custom_staff_charge.html
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/templatetags/__init__.py
--rw-r--r--  2.0 unx     1013 b- defN 23-Jun-04 23:42 NEMO_billing/templatetags/billing_tags.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/tests/__init__.py
--rw-r--r--  2.0 unx     3047 b- defN 23-Jun-04 23:42 NEMO_billing/tests/test_settings.py
--rw-r--r--  2.0 unx     1472 b- defN 23-Jun-04 23:42 NEMO_billing/tests/test_urls.py
--rw-r--r--  2.0 unx     1094 b- defN 23-Jun-04 23:42 NEMO_billing/tests/test_utilities.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/tests/cap/__init__.py
--rw-r--r--  2.0 unx    19469 b- defN 23-Jun-04 23:42 NEMO_billing/tests/cap/test_cap_discount.py
--rw-r--r--  2.0 unx    32811 b- defN 23-Jun-04 23:42 NEMO_billing/tests/cap/test_cap_invoicing.py
--rw-r--r--  2.0 unx     4252 b- defN 23-Jun-04 23:42 NEMO_billing/tests/cap/test_cap_utilities.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-04 23:42 NEMO_billing/tests/rates/__init__.py
--rw-r--r--  2.0 unx    33260 b- defN 23-Jun-04 23:42 NEMO_billing/tests/rates/test_rate_amount.py
--rw-r--r--  2.0 unx    20895 b- defN 23-Jun-04 23:42 NEMO_billing/tests/rates/test_rate_time.py
--rw-r--r--  2.0 unx     6164 b- defN 23-Jun-04 23:42 NEMO_billing/tests/rates/test_rate_uniqueness.py
--rw-r--r--  2.0 unx    27008 b- defN 23-Jun-04 23:42 NEMO_billing/tests/rates/test_split_billables.py
--rw-rw-rw-  2.0 unx     1074 b- defN 23-Jun-04 23:42 NEMO_billing-2.4.0.dist-info/LICENSE
--rw-r--r--  2.0 unx     5343 b- defN 23-Jun-04 23:42 NEMO_billing-2.4.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-04 23:42 NEMO_billing-2.4.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       13 b- defN 23-Jun-04 23:42 NEMO_billing-2.4.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    13238 b- defN 23-Jun-04 23:42 NEMO_billing-2.4.0.dist-info/RECORD
-131 files, 641120 bytes uncompressed, 146520 bytes compressed:  77.1%
+Zip file size: 186715 bytes, number of entries: 147
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/__init__.py
+-rw-r--r--  2.0 unx    14038 b- defN 23-Jun-16 18:26 NEMO_billing/admin.py
+-rw-r--r--  2.0 unx     2638 b- defN 23-Jun-16 18:26 NEMO_billing/api.py
+-rw-r--r--  2.0 unx      285 b- defN 23-Jun-16 18:26 NEMO_billing/app_settings.py
+-rw-r--r--  2.0 unx      426 b- defN 23-Jun-16 18:26 NEMO_billing/apps.py
+-rw-r--r--  2.0 unx      199 b- defN 23-Jun-16 18:26 NEMO_billing/decorators.py
+-rw-r--r--  2.0 unx      122 b- defN 23-Jun-16 18:26 NEMO_billing/exceptions.py
+-rw-r--r--  2.0 unx     5728 b- defN 23-Jun-16 18:26 NEMO_billing/models.py
+-rw-r--r--  2.0 unx     1304 b- defN 23-Jun-16 18:26 NEMO_billing/urls.py
+-rw-r--r--  2.0 unx     3111 b- defN 23-Jun-16 18:26 NEMO_billing/utilities.py
+-rw-r--r--  2.0 unx     6371 b- defN 23-Jun-16 18:26 NEMO_billing/views.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/__init__.py
+-rw-r--r--  2.0 unx     4880 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/admin.py
+-rw-r--r--  2.0 unx      102 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/app_settings.py
+-rw-r--r--  2.0 unx      444 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/apps.py
+-rw-r--r--  2.0 unx     2991 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/customization.py
+-rw-r--r--  2.0 unx      892 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/exceptions.py
+-rw-r--r--  2.0 unx    18130 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/models.py
+-rw-r--r--  2.0 unx    21607 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/processors.py
+-rw-r--r--  2.0 unx      550 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/urls.py
+-rw-r--r--  2.0 unx     1706 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/views.py
+-rw-r--r--  2.0 unx     7568 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/migrations/0001_initial.py
+-rw-r--r--  2.0 unx     1665 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py
+-rw-r--r--  2.0 unx     4815 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py
+-rw-r--r--  2.0 unx     3478 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     1415 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html
+-rw-rw-rw-  2.0 unx     1772 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html
+-rw-rw-rw-  2.0 unx     4068 b- defN 23-Jun-16 18:26 NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/__init__.py
+-rw-r--r--  2.0 unx    10823 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/admin.py
+-rw-r--r--  2.0 unx     7049 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/api.py
+-rw-r--r--  2.0 unx      176 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/app_settings.py
+-rw-r--r--  2.0 unx      445 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/apps.py
+-rw-r--r--  2.0 unx     4448 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/customization.py
+-rw-r--r--  2.0 unx     2642 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/exceptions.py
+-rw-r--r--  2.0 unx    23629 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/models.py
+-rw-r--r--  2.0 unx    12477 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/pdf_utilities.py
+-rw-r--r--  2.0 unx    30163 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/processors.py
+-rw-r--r--  2.0 unx    26169 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/renderers.py
+-rw-r--r--  2.0 unx     3044 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/urls.py
+-rw-r--r--  2.0 unx     4235 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/management/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/management/commands/__init__.py
+-rw-r--r--  2.0 unx      298 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py
+-rw-r--r--  2.0 unx      318 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py
+-rw-r--r--  2.0 unx     9795 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0001_initial.py
+-rw-r--r--  2.0 unx     2794 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0002_version_1_2_0.py
+-rw-r--r--  2.0 unx     1063 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0003_version_1_4_0.py
+-rw-r--r--  2.0 unx      467 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0004_version_1_6_0.py
+-rw-r--r--  2.0 unx      485 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0005_version_1_6_1.py
+-rw-r--r--  2.0 unx      518 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0006_version_1_7_1.py
+-rw-r--r--  2.0 unx      458 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0007_version_1_8_0.py
+-rw-r--r--  2.0 unx      437 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0008_version_1_10_0.py
+-rw-r--r--  2.0 unx     1183 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0009_version_1_23_0.py
+-rw-r--r--  2.0 unx      439 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0010_version_2_0_0.py
+-rw-r--r--  2.0 unx     1280 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/0011_version_2_4_0.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/migrations/__init__.py
+-rw-rw-rw-  2.0 unx     1072 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/static/invoices/invoices.css
+-rw-rw-rw-  2.0 unx     5678 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/customizations/customizations_billing.html
+-rw-rw-rw-  2.0 unx     8157 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/customizations/customizations_invoices.html
+-rw-rw-rw-  2.0 unx      212 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/base.html
+-rw-rw-rw-  2.0 unx    13011 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/invoice.html
+-rw-rw-rw-  2.0 unx     3375 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/invoice_details.html
+-rw-rw-rw-  2.0 unx    12799 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/invoices.html
+-rw-rw-rw-  2.0 unx    13787 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/usage.html
+-rw-rw-rw-  2.0 unx     1274 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html
+-rw-rw-rw-  2.0 unx      173 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt
+-rw-rw-rw-  2.0 unx     1330 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html
+-rw-rw-rw-  2.0 unx     1344 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html
+-rw-rw-rw-  2.0 unx      155 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt
+-rw-rw-rw-  2.0 unx      155 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt
+-rw-rw-rw-  2.0 unx    13693 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/project/edit_project.html
+-rw-rw-rw-  2.0 unx     3668 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/views/__init__.py
+-rw-r--r--  2.0 unx    19159 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/views/invoices.py
+-rw-r--r--  2.0 unx     6908 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/views/project.py
+-rw-r--r--  2.0 unx    10641 b- defN 23-Jun-16 18:26 NEMO_billing/invoices/views/usage.py
+-rw-r--r--  2.0 unx     3156 b- defN 23-Jun-16 18:26 NEMO_billing/migrations/0001_initial.py
+-rw-r--r--  2.0 unx      573 b- defN 23-Jun-16 18:26 NEMO_billing/migrations/0002_version_1_2_0.py
+-rw-r--r--  2.0 unx      466 b- defN 23-Jun-16 18:26 NEMO_billing/migrations/0003_version_2_0_0.py
+-rw-r--r--  2.0 unx     7722 b- defN 23-Jun-16 18:26 NEMO_billing/migrations/0004_version_2_4_0.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/migrations/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/__init__.py
+-rw-r--r--  2.0 unx     2843 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/admin.py
+-rw-r--r--  2.0 unx       71 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/app_settings.py
+-rw-r--r--  2.0 unx      559 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/apps.py
+-rw-r--r--  2.0 unx     1876 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/exceptions.py
+-rw-r--r--  2.0 unx    17083 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/models.py
+-rw-r--r--  2.0 unx     5142 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/policy.py
+-rw-r--r--  2.0 unx      204 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/urls.py
+-rw-r--r--  2.0 unx     4314 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/migrations/0001_initial.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/migrations/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/views/__init__.py
+-rw-r--r--  2.0 unx     2763 b- defN 23-Jun-16 18:26 NEMO_billing/prepayments/views/prepayments.py
+-rw-r--r--  2.0 unx        1 b- defN 23-Jun-16 18:26 NEMO_billing/rates/__init__.py
+-rw-r--r--  2.0 unx     8271 b- defN 23-Jun-16 18:26 NEMO_billing/rates/admin.py
+-rw-r--r--  2.0 unx     2318 b- defN 23-Jun-16 18:26 NEMO_billing/rates/api.py
+-rw-r--r--  2.0 unx      100 b- defN 23-Jun-16 18:26 NEMO_billing/rates/app_settings.py
+-rw-r--r--  2.0 unx      715 b- defN 23-Jun-16 18:26 NEMO_billing/rates/apps.py
+-rw-r--r--  2.0 unx      520 b- defN 23-Jun-16 18:26 NEMO_billing/rates/customization.py
+-rw-r--r--  2.0 unx     1913 b- defN 23-Jun-16 18:26 NEMO_billing/rates/model_diff.py
+-rw-r--r--  2.0 unx    22892 b- defN 23-Jun-16 18:26 NEMO_billing/rates/models.py
+-rw-r--r--  2.0 unx     4042 b- defN 23-Jun-16 18:26 NEMO_billing/rates/rates_class.py
+-rw-r--r--  2.0 unx      838 b- defN 23-Jun-16 18:26 NEMO_billing/rates/urls.py
+-rw-r--r--  2.0 unx    12483 b- defN 23-Jun-16 18:26 NEMO_billing/rates/views.py
+-rw-r--r--  2.0 unx     5101 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/0001_initial.py
+-rw-r--r--  2.0 unx      602 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/0002_version_1_15_0.py
+-rw-r--r--  2.0 unx     1999 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/0003_version_1_17_0.py
+-rw-r--r--  2.0 unx      421 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/0004_version_2_0_0.py
+-rw-r--r--  2.0 unx      448 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/0005_version_2_3_0.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/rates/migrations/__init__.py
+-rw-rw-rw-  2.0 unx       81 b- defN 23-Jun-16 18:26 NEMO_billing/rates/static/rates/rates.css
+-rw-rw-rw-  2.0 unx     1808 b- defN 23-Jun-16 18:26 NEMO_billing/rates/templates/customizations/customizations_billing_rates.html
+-rw-rw-rw-  2.0 unx      160 b- defN 23-Jun-16 18:26 NEMO_billing/rates/templates/rates/base.html
+-rw-rw-rw-  2.0 unx     6047 b- defN 23-Jun-16 18:26 NEMO_billing/rates/templates/rates/rate.html
+-rw-rw-rw-  2.0 unx     5591 b- defN 23-Jun-16 18:26 NEMO_billing/rates/templates/rates/rate_form_details.html
+-rw-rw-rw-  2.0 unx     4602 b- defN 23-Jun-16 18:26 NEMO_billing/rates/templates/rates/rates.html
+-rw-rw-rw-  2.0 unx      192 b- defN 23-Jun-16 18:26 NEMO_billing/templates/base/navbar.html
+-rw-rw-rw-  2.0 unx     1065 b- defN 23-Jun-16 18:26 NEMO_billing/templates/base/navbar_billing.html
+-rw-rw-rw-  2.0 unx     1162 b- defN 23-Jun-16 18:26 NEMO_billing/templates/billing/cap_and_prepaid_base.html
+-rw-rw-rw-  2.0 unx     8882 b- defN 23-Jun-16 18:26 NEMO_billing/templates/billing/custom_charge.html
+-rw-rw-rw-  2.0 unx     2074 b- defN 23-Jun-16 18:26 NEMO_billing/templates/billing/custom_charges.html
+-rw-rw-rw-  2.0 unx     1259 b- defN 23-Jun-16 18:26 NEMO_billing/templates/staff_charges/choose_project.html
+-rw-rw-rw-  2.0 unx     1979 b- defN 23-Jun-16 18:26 NEMO_billing/templates/staff_charges/new_custom_staff_charge.html
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/templatetags/__init__.py
+-rw-r--r--  2.0 unx     1013 b- defN 23-Jun-16 18:26 NEMO_billing/templatetags/billing_tags.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/tests/__init__.py
+-rw-r--r--  2.0 unx     3079 b- defN 23-Jun-16 18:26 NEMO_billing/tests/test_settings.py
+-rw-r--r--  2.0 unx     1472 b- defN 23-Jun-16 18:26 NEMO_billing/tests/test_urls.py
+-rw-r--r--  2.0 unx     1094 b- defN 23-Jun-16 18:26 NEMO_billing/tests/test_utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/tests/cap/__init__.py
+-rw-r--r--  2.0 unx    19521 b- defN 23-Jun-16 18:26 NEMO_billing/tests/cap/test_cap_discount.py
+-rw-r--r--  2.0 unx    32811 b- defN 23-Jun-16 18:26 NEMO_billing/tests/cap/test_cap_invoicing.py
+-rw-r--r--  2.0 unx     4271 b- defN 23-Jun-16 18:26 NEMO_billing/tests/cap/test_cap_utilities.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/tests/prepayments/__init__.py
+-rw-r--r--  2.0 unx    14410 b- defN 23-Jun-16 18:26 NEMO_billing/tests/prepayments/test_prepayments.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 18:26 NEMO_billing/tests/rates/__init__.py
+-rw-r--r--  2.0 unx    33260 b- defN 23-Jun-16 18:26 NEMO_billing/tests/rates/test_rate_amount.py
+-rw-r--r--  2.0 unx    20895 b- defN 23-Jun-16 18:26 NEMO_billing/tests/rates/test_rate_time.py
+-rw-r--r--  2.0 unx     6164 b- defN 23-Jun-16 18:26 NEMO_billing/tests/rates/test_rate_uniqueness.py
+-rw-r--r--  2.0 unx    27008 b- defN 23-Jun-16 18:26 NEMO_billing/tests/rates/test_split_billables.py
+-rw-rw-rw-  2.0 unx     1074 b- defN 23-Jun-16 18:26 NEMO_billing-2.5.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     5343 b- defN 23-Jun-16 18:26 NEMO_billing-2.5.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-16 18:26 NEMO_billing-2.5.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       13 b- defN 23-Jun-16 18:26 NEMO_billing-2.5.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    14823 b- defN 23-Jun-16 18:26 NEMO_billing-2.5.0.dist-info/RECORD
+147 files, 702412 bytes uncompressed, 162371 bytes compressed:  76.9%
```

## zipnote {}

```diff
@@ -72,14 +72,17 @@
 
 Filename: NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py
 Comment: 
 
 Filename: NEMO_billing/cap_discount/migrations/__init__.py
 Comment: 
 
+Filename: NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html
+Comment: 
+
 Filename: NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html
 Comment: 
 
 Filename: NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html
 Comment: 
 
 Filename: NEMO_billing/invoices/__init__.py
@@ -240,14 +243,50 @@
 
 Filename: NEMO_billing/migrations/0004_version_2_4_0.py
 Comment: 
 
 Filename: NEMO_billing/migrations/__init__.py
 Comment: 
 
+Filename: NEMO_billing/prepayments/__init__.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/admin.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/app_settings.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/apps.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/exceptions.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/models.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/policy.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/urls.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/migrations/0001_initial.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/migrations/__init__.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/views/__init__.py
+Comment: 
+
+Filename: NEMO_billing/prepayments/views/prepayments.py
+Comment: 
+
 Filename: NEMO_billing/rates/__init__.py
 Comment: 
 
 Filename: NEMO_billing/rates/admin.py
 Comment: 
 
 Filename: NEMO_billing/rates/api.py
@@ -315,14 +354,17 @@
 
 Filename: NEMO_billing/templates/base/navbar.html
 Comment: 
 
 Filename: NEMO_billing/templates/base/navbar_billing.html
 Comment: 
 
+Filename: NEMO_billing/templates/billing/cap_and_prepaid_base.html
+Comment: 
+
 Filename: NEMO_billing/templates/billing/custom_charge.html
 Comment: 
 
 Filename: NEMO_billing/templates/billing/custom_charges.html
 Comment: 
 
 Filename: NEMO_billing/templates/staff_charges/choose_project.html
@@ -357,14 +399,20 @@
 
 Filename: NEMO_billing/tests/cap/test_cap_invoicing.py
 Comment: 
 
 Filename: NEMO_billing/tests/cap/test_cap_utilities.py
 Comment: 
 
+Filename: NEMO_billing/tests/prepayments/__init__.py
+Comment: 
+
+Filename: NEMO_billing/tests/prepayments/test_prepayments.py
+Comment: 
+
 Filename: NEMO_billing/tests/rates/__init__.py
 Comment: 
 
 Filename: NEMO_billing/tests/rates/test_rate_amount.py
 Comment: 
 
 Filename: NEMO_billing/tests/rates/test_rate_time.py
@@ -372,23 +420,23 @@
 
 Filename: NEMO_billing/tests/rates/test_rate_uniqueness.py
 Comment: 
 
 Filename: NEMO_billing/tests/rates/test_split_billables.py
 Comment: 
 
-Filename: NEMO_billing-2.4.0.dist-info/LICENSE
+Filename: NEMO_billing-2.5.0.dist-info/LICENSE
 Comment: 
 
-Filename: NEMO_billing-2.4.0.dist-info/METADATA
+Filename: NEMO_billing-2.5.0.dist-info/METADATA
 Comment: 
 
-Filename: NEMO_billing-2.4.0.dist-info/WHEEL
+Filename: NEMO_billing-2.5.0.dist-info/WHEEL
 Comment: 
 
-Filename: NEMO_billing-2.4.0.dist-info/top_level.txt
+Filename: NEMO_billing-2.5.0.dist-info/top_level.txt
 Comment: 
 
-Filename: NEMO_billing-2.4.0.dist-info/RECORD
+Filename: NEMO_billing-2.5.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## NEMO_billing/models.py

```diff
@@ -1,8 +1,9 @@
 import pytz
+from NEMO.exceptions import ProjectChargeException
 from NEMO.models import (
     Area,
     BaseCategory,
     BaseModel,
     Consumable,
     Project,
     SerializationByNameModel,
@@ -67,14 +68,20 @@
     core_facility = models.ForeignKey(CoreFacility, null=True, blank=True, on_delete=models.SET_NULL)
     cap_eligible = models.BooleanField(default=False, help_text="Check this box to make this charge count towards CAP")
 
     def clean(self):
         errors = {}
         if self.amount == 0:
             errors["amount"] = "Please enter a positive or negative amount"
+        if self.project_id and self.customer_id:
+            try:
+                from NEMO.policy import policy_class as policy
+                policy.check_billing_to_project(self.project, self.customer, self)
+            except ProjectChargeException as e:
+                errors["project"] = e.msg
         if cap_discount_installed():
             # If this custom charge is cap eligible, check that there is actually a matching CAP configuration
             if self.cap_eligible:
                 if self.customer_id and self.project_id:
                     from NEMO_billing.cap_discount.models import CAPDiscountConfiguration
 
                     rate_category = self.project.projectbillingdetails.category
```

## NEMO_billing/utilities.py

```diff
@@ -1,13 +1,81 @@
+import datetime
+
+from django import forms
+from django.core.exceptions import ValidationError
+from django.db import models
+from django.db.models import Q
 from django.forms import BaseForm, HiddenInput
 
 
+class Months(models.IntegerChoices):
+    JAN = 1, "JANUARY"
+    FEB = 2, "FEBRUARY"
+    MAR = 3, "MARCH"
+    APR = 4, "APRIL"
+    MAY = 5, "MAY"
+    JUN = 6, "JUNE"
+    JUL = 7, "JULY"
+    AUG = 8, "AUGUST"
+    SEP = 9, "SEPTEMBER"
+    OCT = 10, "OCTOBER"
+    NOV = 11, "NOVEMBER"
+    DEC = 12, "DECEMBER"
+
+
+class IntMultipleChoiceField(forms.MultipleChoiceField):
+    def prepare_value(self, value):
+        if value is None:
+            return value
+        if type(value) is list:
+            return [int(val) for val in value]
+        return value.split(",")
+
+    def to_python(self, value):
+        value = super().to_python(value)
+        if not value:
+            return []
+        elif not isinstance(value, (list, tuple)):
+            raise ValidationError(self.error_messages["invalid_list"], code="invalid_list")
+        return ",".join([str(val) for val in value])
+
+    def validate(self, value):
+        """Validate that the input is a list or tuple."""
+        if self.required and not value:
+            raise ValidationError(self.error_messages["required"], code="required")
+        # Validate that each value in the value list is in self.choices.
+        for val in value.split(","):
+            if not self.valid_value(val):
+                raise ValidationError(
+                    self.error_messages["invalid_choice"],
+                    code="invalid_choice",
+                    params={"value": val},
+                )
+
+
 def disable_form_field(form: BaseForm, field_name):
     if field_name in form.fields:
         form.fields[field_name].disabled = True
         form.fields[field_name].required = False
 
 
 def hide_form_field(form: BaseForm, field_name):
     if field_name in form.fields:
         disable_form_field(form, field_name)
         form.fields[field_name].widget = HiddenInput()
+
+
+# Utility functions to compare dates that are stored in month/year format
+def filter_date_year_month_gte(field_name: str, date_to_compare: datetime.date) -> Q:
+    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gte": date_to_compare.month})
+
+
+def filter_date_year_month_gt(field_name: str, date_to_compare: datetime.date) -> Q:
+    return Q(**{f"{field_name}_year__gt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__gt": date_to_compare.month})
+
+
+def filter_date_year_month_lt(field_name: str, date_to_compare: datetime.date) -> Q:
+    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lt": date_to_compare.month})
+
+
+def filter_date_year_month_lte(field_name: str, date_to_compare: datetime.date) -> Q:
+    return Q(**{f"{field_name}_year__lt": date_to_compare.year}) | Q(**{f"{field_name}_year": date_to_compare.year, f"{field_name}_month__lte": date_to_compare.month})
```

## NEMO_billing/views.py

```diff
@@ -22,15 +22,15 @@
 from django.contrib.auth.decorators import login_required
 from django.http import HttpResponseBadRequest
 from django.shortcuts import get_object_or_404, redirect, render
 from django.urls import reverse
 from django.views.decorators.http import require_GET, require_POST, require_http_methods
 
 from NEMO_billing.admin import CustomChargeAdminForm, save_or_delete_core_facility
-from NEMO_billing.models import CoreFacility, CustomCharge
+from NEMO_billing.models import CoreFacility, CoreRelationship, CustomCharge
 
 
 @accounting_or_user_office_or_manager_required
 @require_http_methods(["GET", "POST"])
 def custom_charges(request):
     page = SortedPaginator(CustomCharge.objects.all(), request, order_by="-date").get_current_page()
     core_facilities_exist = CoreFacility.objects.exists()
@@ -108,14 +108,15 @@
         return HttpResponseBadRequest("You cannot create a new staff charge when one is already in progress.")
     charge = StaffCharge()
     charge.customer = User.objects.get(id=request.POST["customer"])
     charge.project = Project.objects.get(id=request.POST["project"])
     core_facility = None
     try:
         core_facility = CoreFacility.objects.get(id=request.POST["core_facility"])
+        charge.cor_rel = CoreRelationship(core_facility=core_facility, staff_charge=charge)
     except:
         pass
     if settings.STAFF_CHARGE_CORE_FACILITY_REQUIRED and not core_facility:
         return HttpResponseBadRequest("You cannot create a new staff charge without a core facility.")
     # Check if we are allowed to bill to project
     try:
         policy.check_billing_to_project(charge.project, charge.customer, charge)
```

## NEMO_billing/cap_discount/admin.py

```diff
@@ -1,48 +1,17 @@
 from NEMO.admin import AtLeastOneRequiredInlineFormSet
 from NEMO.utilities import format_datetime
 from django import forms
 from django.contrib.admin import ModelAdmin, TabularInline, display, register, widgets
-from django.core.exceptions import ValidationError
 from django.utils.safestring import mark_safe
 
 from NEMO_billing.cap_discount.customization import CAPDiscountCustomization
 from NEMO_billing.cap_discount.models import CAPDiscount, CAPDiscountAmount, CAPDiscountConfiguration, CAPDiscountTier
 from NEMO_billing.invoices.models import BillableItemType
-from NEMO_billing.utilities import disable_form_field
-
-
-class IntMultipleChoiceField(forms.MultipleChoiceField):
-    def prepare_value(self, value):
-        if value is None:
-            return value
-        if type(value) is list:
-            return [int(val) for val in value]
-        return value.split(",")
-
-    def to_python(self, value):
-        value = super().to_python(value)
-        if not value:
-            return []
-        elif not isinstance(value, (list, tuple)):
-            raise ValidationError(self.error_messages["invalid_list"], code="invalid_list")
-        return ",".join([str(val) for val in value])
-
-    def validate(self, value):
-        """Validate that the input is a list or tuple."""
-        if self.required and not value:
-            raise ValidationError(self.error_messages["required"], code="required")
-        # Validate that each value in the value list is in self.choices.
-        for val in value.split(","):
-            if not self.valid_value(val):
-                raise ValidationError(
-                    self.error_messages["invalid_choice"],
-                    code="invalid_choice",
-                    params={"value": val},
-                )
+from NEMO_billing.utilities import IntMultipleChoiceField, disable_form_field
 
 
 class CAPDiscountAmountInline(TabularInline):
     model = CAPDiscountAmount
     readonly_fields = ("new_charges",)
     extra = 1
```

## NEMO_billing/cap_discount/apps.py

```diff
@@ -7,9 +7,9 @@
 for name in dir(defaults):
     if name.isupper() and not hasattr(settings, name):
         setattr(settings, name, getattr(defaults, name))
 
 
 class CapConfig(AppConfig):
     name = "NEMO_billing.cap_discount"
-    verbose_name = "Cap Discount"
+    verbose_name = "Billing Cap Discount"
     default_auto_field = "django.db.models.AutoField"
```

## NEMO_billing/cap_discount/models.py

```diff
@@ -11,29 +11,15 @@
 from django.core.validators import MaxValueValidator, MinValueValidator, validate_comma_separated_integer_list
 from django.db import models, transaction
 from django.db.models import Q, UniqueConstraint
 
 from NEMO_billing.invoices.models import BillableItemType
 from NEMO_billing.models import CoreFacility
 from NEMO_billing.rates.models import RateCategory
-
-
-class Months(models.IntegerChoices):
-    JAN = 1, "JANUARY"
-    FEB = 2, "FEBRUARY"
-    MAR = 3, "MARCH"
-    APR = 4, "APRIL"
-    MAY = 5, "MAY"
-    JUN = 6, "JUNE"
-    JUL = 7, "JULY"
-    AUG = 8, "AUGUST"
-    SEP = 9, "SEPTEMBER"
-    OCT = 10, "OCTOBER"
-    NOV = 11, "NOVEMBER"
-    DEC = 12, "DECEMBER"
+from NEMO_billing.utilities import Months
 
 
 class CAPDiscountConfiguration(BaseModel):
     rate_category = models.ForeignKey(
         RateCategory, help_text="The rate category this CAP applies to", on_delete=models.CASCADE
     )
     core_facility = models.ForeignKey(
@@ -285,14 +271,18 @@
         dt_datetime = datetime(dt.year, dt.month, dt.day)
         recurrence = self.get_recurrence()
         return recurrence.after(dt_datetime, inc=inc) if recurrence else None
 
     def next_reset(self, inc=False) -> datetime:
         return self.next_reset_date_after(date.today(), inc=inc)
 
+    def last_reset(self) -> datetime:
+        recurrence = self.get_recurrence()
+        return recurrence.before(datetime.now(), inc=False) if recurrence else None
+
     @transaction.atomic
     def reset(self):
         # Reinitialize based on the linked configuration, and blank out reset override
         cap_discount_tiers = self.configuration.initialize_cap_discount_and_get_tiers(self)
         # Save the new tiers
         self.save_related_cap_tiers(cap_discount_tiers)
         if self.next_reset_override and self.configuration.start_on_first_charge:
@@ -369,24 +359,24 @@
         help_text="Amount after which the discount will be applied",
         validators=[MinValueValidator(1)],
     )
     discount = models.DecimalField(
         decimal_places=3,
         max_digits=6,
         help_text="Discount in percent. Ex 20.5%",
-        validators=[MinValueValidator(1), MaxValueValidator(100)],
+        validators=[MinValueValidator(0), MaxValueValidator(100)],
     )
 
     def discount_amount(self) -> Decimal:
         return -self.discount / Decimal(100)
 
     def clean(self):
-        if not self.cap_discount_id and not self.cap_discount_configuration_id:
+        if not self.cap_discount and not self.cap_discount_configuration:
             raise ValidationError("One of cap discount or cap discount configuration needs to be set")
-        if self.cap_discount_id and self.cap_discount_configuration_id:
+        if self.cap_discount and self.cap_discount_configuration:
             raise ValidationError("Discount tiers cannot be linked to both cap discount and cap discount configuration")
 
     class Meta:
         ordering = ["amount"]
 
     def __str__(self):
         return f"> {self.amount} -> {self.discount} %"
```

## NEMO_billing/cap_discount/processors.py

```diff
@@ -128,36 +128,44 @@
         check_and_initialize_monthly_cap_amounts(account, start)
 
         # Now create our cap calculator helper
         discount_calculator = AccountDiscountCalculator(start.date())
 
         # Go through the generation process, and add all items to account details list
         all_account_details: List[InvoiceDetailItem] = []
-        invoices: List[FullInvoice] = []
+        capped_invoices: List[FullInvoice] = []
+        non_capped_invoices: List[FullInvoice] = []
         for project in account.project_set.all():
             invoice = self.generate_invoice(start, end, project, configuration, user, raise_if_exists)
             if invoice:
-                invoices.append(invoice)
-                all_account_details.extend(invoice.detail_items)
+                # do not run cap calculations for prepaid projects
+                if hasattr(project, "projectprepaymentdetail"):
+                    non_capped_invoices.append(invoice)
+                else:
+                    capped_invoices.append(invoice)
+                    all_account_details.extend(invoice.detail_items)
 
         if all_account_details:
             # Sort account details by end date. This is very IMPORTANT to get discounts right
             all_account_details.sort(key=lambda x: x.end)
             # Go through all account charges to figure out the discounts
             for detail in all_account_details:
                 discount_calculator.add_item(detail)
             # Now let's update the CAP entities with the total charges for this account
             for cap_discount in discount_calculator.all_cap_discounts():
                 amount = CAPDiscountAmount.objects.get(cap_discount=cap_discount, year=start.year, month=start.month)
                 amount.end = cap_discount.tmp_current_amount
                 amount.save(update_fields=["end"])
 
         # Save all the invoices now
-        self.save_invoices(invoices, discount_calculator)
-        return [full_invoice.invoice for full_invoice in invoices]
+        self.save_invoices(capped_invoices, discount_calculator)
+        # Only save regular invoices after everything went well for CAP invoices
+        for invoice in non_capped_invoices:
+            invoice.save()
+        return [full_invoice.invoice for full_invoice in (capped_invoices + non_capped_invoices)]
 
     def save_invoices(self, full_invoices: List[FullInvoice], discount_calculator: AccountDiscountCalculator = None):
         for full_invoice in full_invoices:
             # Pass calculator through the invoice, so we can retrieve it later
             full_invoice.invoice.discount_calculator = discount_calculator
             # Recalculate summaries with the discounts
             full_invoice.summary_items = self.get_invoice_summary_items(full_invoice.invoice, full_invoice.detail_items)
@@ -205,14 +213,15 @@
         facility_subtotal.amount = sum(item.amount for item in details) + total_discount
         facility_summaries.append(facility_subtotal)
 
         return facility_summaries
 
     @transaction.atomic
     def delete_invoice(self, invoice: Invoice, request: HttpRequest):
+        # NOTE: For now, we are deleting all invoices for this account, even non-capped ones
         # if this invoice has a CAP Discount associated with its account,
         # delete all the other account invoices and CAP amounts for the month.
         # This will force to re-generate all the invoices and CAP calculation.
         invoice_account = invoice.project_details.project.account
         invoice_year, invoice_month = invoice.start.year, invoice.start.month
         invoices_to_delete: List[Invoice] = get_cap_related_invoices(invoice_account, invoice_year, invoice_month)
         try:
@@ -221,14 +230,15 @@
             messages.error(request, e.msg, extra_tags=error_extra_tags)
             return
         for invoice in invoices_to_delete:
             super().delete_invoice(invoice, request)
 
     @transaction.atomic
     def void_invoice(self, invoice: Invoice, request: HttpRequest):
+        # NOTE: For now, we are deleting all invoices for this account, even non-capped ones
         invoice_account = invoice.project_details.project.account
         invoice_year, invoice_month = invoice.start.year, invoice.start.month
         invoices_to_void: List[Invoice] = get_cap_related_invoices(invoice_account, invoice_year, invoice_month)
         try:
             delete_associated_amounts(invoice_account, invoice_year, invoice_month, request)
         except NotLatestInvoiceException as e:
             messages.error(request, e.msg, extra_tags=error_extra_tags)
```

## NEMO_billing/cap_discount/urls.py

```diff
@@ -6,8 +6,9 @@
     path("usage_cap_discounts/", views.usage_cap_discounts, name="usage_cap_discounts"),
     path("usage_cap_discounts_user/<int:user_id>/", views.usage_cap_discounts_user, name="usage_cap_discounts_user"),
     path(
         "usage_cap_discounts_account/<int:account_id>/",
         views.usage_cap_discounts_account,
         name="usage_cap_discounts_account",
     ),
+    path("cap_discount_status/", views.cap_discount_status, name="cap_discount_status"),
 ]
```

## NEMO_billing/cap_discount/views.py

```diff
@@ -1,12 +1,14 @@
 from NEMO.decorators import accounting_or_user_office_or_manager_required
 from NEMO.models import Account, User
+from NEMO.views.pagination import SortedPaginator
 from NEMO.views.usage import date_parameters_dictionary
 from django.contrib.auth.decorators import login_required
 from django.shortcuts import get_object_or_404, render
+from django.views.decorators.http import require_http_methods
 
 from NEMO_billing.cap_discount.models import CAPDiscount
 
 
 @login_required
 def usage_cap_discounts(request, user=None):
     if not user:
@@ -23,7 +25,14 @@
 
 
 @accounting_or_user_office_or_manager_required
 def usage_cap_discounts_account(request, account_id):
     base_dictionary, start, end, kind, identifier = date_parameters_dictionary(request)
     base_dictionary["cap_discounts"] = CAPDiscount.objects.filter(account=get_object_or_404(Account, pk=account_id))
     return render(request, "cap_discount/usage_cap_discounts.html", base_dictionary)
+
+
+@accounting_or_user_office_or_manager_required
+@require_http_methods(["GET", "POST"])
+def cap_discount_status(request):
+    page = SortedPaginator(CAPDiscount.objects.all(), request, order_by="configuration").get_current_page()
+    return render(request, "cap_discount/cap_discount_status.html", {"page": page})
```

## NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py

```diff
@@ -36,15 +36,15 @@
 
     operations = [
         migrations.CreateModel(
             name='CAPDiscountTier',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('amount', models.DecimalField(decimal_places=2, help_text='Amount after which the discount will be applied', max_digits=14, validators=[django.core.validators.MinValueValidator(1)])),
-                ('discount', models.DecimalField(decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(100)])),
+                ('discount', models.DecimalField(decimal_places=3, help_text='Discount in percent. Ex 20.5%', max_digits=6, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                 ('cap_discount', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscount')),
                 ('cap_discount_configuration', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='cap_discount.capdiscountconfiguration')),
             ],
             options={
                 'ordering': ['amount'],
             },
         ),
```

## NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html

```diff
@@ -1,19 +1,21 @@
 {% load static %}
 {% load custom_tags_and_filters %}
 {% load billing_tags %}
 <div>
 	<br>
 	{% for cap_discount in cap_discounts %}
-		{% widthratio .75 1 cap_discount.amount as warn_limit %}
-		<div style="padding: 15px 30px" class="alert {% if cap_discount.latest_amount.end >= cap_discount.amount %}alert-success{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}alert-warning{% else %}alert-danger{% endif %} alert-link">
-			<span style="font-weight:bold">{{ cap_discount }}</span><br>
-			<div>
-				<u>Amount:</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end >= cap_discount.amount %}success-highlight{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0 }}</span>/{{ cap_discount.amount }}</span><br>
-				<u>Last updated:</u> {{ cap_discount.latest_amount.amount_date|date:"F Y" }}<br>
-				<u>Current estimated amount</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update >= cap_discount.amount %}success-highlight{% elif cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0|add:cap_discount.estimated_charges_since_last_update }}</span>/{{ cap_discount.amount }}</span><br>
-				<u>Started:</u> {{ cap_discount.start|date:"F Y" }}<br>
-				<u>Next reset:</u> {{ cap_discount.next_reset.date|date:"F Y" }}<br>
+		{% with cap_highest_amount=cap_discount.capdiscounttier_set.last.amount %}
+			{% widthratio .75 1 cap_highest_amount as warn_limit %}
+			<div style="padding: 15px 30px" class="alert {% if cap_discount.latest_amount.end >= cap_highest_amount %}alert-success{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}alert-warning{% else %}alert-danger{% endif %} alert-link">
+				<span style="font-weight:bold">{{ cap_discount }}</span><br>
+				<div>
+					<u>Amount:</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0 }}</span>/{{ cap_highest_amount }}</span><br>
+					<u>Last updated:</u> {{ cap_discount.latest_amount.amount_date|date:"F Y" }}<br>
+					<u>Current estimated amount</u> <span style="font-weight: bold"><span class="{% if cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update >= cap_highest_amount %}success-highlight{% elif cap_discount.latest_amount.end|add:cap_discount.estimated_charges_since_last_update|to_int >= warn_limit|to_int %}warning-highlight{% else %}danger-highlight{% endif %}">{{ cap_discount.latest_amount.end|default:0|add:cap_discount.estimated_charges_since_last_update }}</span>/{{ cap_highest_amount }}</span><br>
+					<u>Started:</u> {{ cap_discount.last_reset.date|date:"F Y" }}<br>
+					<u>Next reset:</u> {{ cap_discount.next_reset.date|date:"F Y" }}<br>
+				</div>
 			</div>
-		</div>
+		{% endwith %}
 	{% endfor %}
 </div>
```

## NEMO_billing/invoices/admin.py

```diff
@@ -88,14 +88,21 @@
 
 @admin.action(description="Mark selected invoices as reviewed")
 def review_invoices(modeladmin, request, queryset):
     for invoice in queryset.all():
         review_invoice(request, invoice.id)
 
 
+@admin.action(description="Mark selected invoices as reviewed and send them")
+def review_and_send_invoices(modeladmin, request, queryset):
+    for invoice in queryset.all():
+        review_invoice(request, invoice.id)
+        send_invoice(request, invoice.id)
+
+
 @admin.action(description="Mark selected invoices as void")
 def void_invoices(modeladmin, request, queryset):
     for invoice in queryset.all():
         void_invoice(request, invoice.id)
 
 
 @admin.action(description="Download selected invoices")
```

## NEMO_billing/invoices/apps.py

```diff
@@ -7,9 +7,9 @@
 for name in dir(defaults):
     if name.isupper() and not hasattr(settings, name):
         setattr(settings, name, getattr(defaults, name))
 
 
 class NEMOInvoicesConfig(AppConfig):
     name = "NEMO_billing.invoices"
-    verbose_name = "Invoices"
+    verbose_name = "Billing Invoices"
     default_auto_field = "django.db.models.AutoField"
```

## NEMO_billing/invoices/models.py

```diff
@@ -49,27 +49,34 @@
             (cls.CONSUMABLE.value, "consumable"),
             (cls.MISSED_RESERVATION.value, "missed_reservation"),
             (cls.STAFF_CHARGE.value, "staff_charge"),
             (cls.TRAINING.value, "training_session"),
             (cls.CUSTOM_CHARGE.value, "custom_charge"),
         )
 
+    @classmethod
+    def choices_except(cls, *billable_types):
+        return [item for item in cls.choices() if BillableItemType(item[0]) not in billable_types]
+
     def is_time_type(self):
         return self in [
             BillableItemType.TOOL_USAGE,
             BillableItemType.AREA_ACCESS,
             BillableItemType.TRAINING,
             BillableItemType.STAFF_CHARGE,
             BillableItemType.MISSED_RESERVATION,
         ]
 
     def display_name(self):
         choices_as_dict = dict(self.choices())
         return choices_as_dict.get(self.value)
 
+    def friendly_display_name(self):
+        return self.display_name().replace("_", " ").capitalize()
+
     def category_name_for_item_type(self):
         return category_name_for_item_type(self)
 
 
 class ProjectBillingDetails(BaseModel):
     project = models.OneToOneField(Project, on_delete=models.CASCADE)
     category = models.ForeignKey(RateCategory, null=True, blank=True, on_delete=models.SET_NULL)
@@ -182,15 +189,15 @@
         default=False, help_text="Check this box to display custom charges as a separate invoice category"
     )
 
     def tax_display(self):
         return f"{self.tax:.2f}"
 
     def tax_amount(self):
-        return self.tax / Decimal(100)
+        return (self.tax or Decimal(0)) / Decimal(100)
 
     def __str__(self):
         return self.name
 
     @classmethod
     def first_or_default(cls):
         try:
@@ -490,21 +497,23 @@
     class InvoiceSummaryItemType(object):
         ITEM = 1  # Any billable summary item
         SUBTOTAL = 2  # Facility subtotal (sum of billable summary item minus discounts)
         DISCOUNT_SUBTOTAL = 3  # Facility amount for discount (only used to calculate future accumulation discounts)
         DISCOUNT = 4  # Facility discount
         TAX = 5  # Tax
         OTHER = 6  # Other
+        FUND = 7  # Other
         choices = (
             (ITEM, "item"),
             (SUBTOTAL, "sub_total"),
             (DISCOUNT_SUBTOTAL, "discount_sub_total"),
             (DISCOUNT, "discount"),
             (TAX, "tax"),
             (OTHER, "other"),
+            (FUND, "fund"),
         )
 
     invoice = models.ForeignKey(Invoice, on_delete=models.CASCADE)
     summary_item_type = models.IntegerField(choices=InvoiceSummaryItemType.choices)
     item_type = models.IntegerField(null=True, blank=True, choices=BillableItemType.choices())
     core_facility = models.CharField(null=True, blank=True, max_length=255)
     name = models.CharField(max_length=255)
```

## NEMO_billing/invoices/processors.py

```diff
@@ -1,11 +1,11 @@
 import importlib
 from collections import defaultdict
 from copy import deepcopy
-from datetime import datetime
+from datetime import datetime, timedelta
 from decimal import Decimal
 from functools import partial
 from typing import Dict, Iterable, List, Optional, Union
 
 from NEMO.models import (
     AreaAccessRecord,
     ConsumableWithdraw,
@@ -17,14 +17,15 @@
     User,
 )
 from NEMO.utilities import get_month_timeframe
 from NEMO.views.api_billing import get_minutes_between_dates
 from django.conf import settings
 from django.contrib import messages
 from django.contrib.admin.utils import get_deleted_objects
+from django.db import transaction
 from django.db.models import Q
 from django.http import HttpRequest
 from django.utils import timezone
 
 from NEMO_billing.invoices.exceptions import (
     InvoiceAlreadyExistException,
     InvoiceItemsNotInFacilityException,
@@ -172,14 +173,25 @@
     def display_amount(self):
         return display_amount(self.amount, self.configuration)
 
     @property
     def rate_time_name_add(self):
         return f" - {self.rate.time.name}" if self.rate and self.rate.time else ""
 
+    @property
+    def display_quantity(self):
+        if self.item_type in [
+            BillableItemType.CONSUMABLE,
+            BillableItemType.CUSTOM_CHARGE,
+            BillableItemType.MISSED_RESERVATION,
+        ]:
+            return self.quantity
+        else:
+            return timedelta(seconds=round(self.quantity * 60))
+
     def copy_and_calculate_amount(self, rate, new_start, new_end):
         new_billable = deepcopy(self)
         new_billable.rate = rate
         new_billable.start = new_start
         new_billable.end = new_end
         # Calculate quantity only if it wasn't already set
         if not new_billable.quantity:
@@ -232,14 +244,16 @@
         invoice_list = []
         for project in account.project_set.all():
             invoice = self.generate_invoice_for_project(month, project, configuration, user, raise_if_exists)
             if invoice:
                 invoice_list.append(invoice)
         return invoice_list
 
+    # Do all this in a transaction so everything gets rolled back if an error happened
+    @transaction.atomic
     def generate_invoice_for_project(self, month, project, configuration, user, raise_if_exists=False) -> Invoice:
         # Start and end will be included in the results. So for example for September data, use: 09/01 12am to 09/30 11:59:99
         start, end = get_month_timeframe(month)
         full_invoice = self.generate_invoice(start, end, project, configuration, user, raise_if_exists)
         if full_invoice:
             full_invoice.save()
             return full_invoice.invoice
@@ -261,15 +275,17 @@
             # Project can be charged, so proceed
             return invoice_data_processor_class.process_data(start, end, project_details, configuration, user)
 
     def process_data(self, start, end, project_details, configuration, user: User) -> Optional[FullInvoice]:
         invoice = self.create_invoice(start, end, project_details, configuration, user)
         project_filter = Q(project_id=project_details.project_id)
         billables = self.get_billable_items(start, end, configuration, project_filter, project_filter, project_filter)
-        detail_items: List[InvoiceDetailItem] = list(map(partial(billable_to_invoice_detail_item, invoice=invoice), billables))
+        detail_items: List[InvoiceDetailItem] = list(
+            map(partial(billable_to_invoice_detail_item, invoice=invoice), billables)
+        )
         if settings.INVOICE_ALL_ITEMS_MUST_BE_IN_FACILITY:
             for detail_item in detail_items:
                 if not detail_item.core_facility:
                     raise InvoiceItemsNotInFacilityException(detail_item)
         if detail_items:
             summary_items = self.get_invoice_summary_items(invoice, detail_items)
             return FullInvoice(invoice, detail_items, summary_items)
@@ -314,22 +330,30 @@
         invoice.end = end
         invoice.project_details = project_details
         invoice.configuration = configuration
         invoice.created_by = user
         invoice.total_amount = 0
         return invoice
 
+    @transaction.atomic
     def void_invoice(self, invoice: Invoice, request: HttpRequest):
         if not invoice.voided_date:
+            if hasattr(invoice.project_details.project, "projectprepaymentdetail"):
+                invoice.project_details.project.projectprepaymentdetail.restore_funds(invoice, request)
             invoice.voided_date = timezone.now()
             invoice.voided_by = request.user
             invoice.save()
-            messages.success(request, f"Invoice {invoice.invoice_number} was successfully marked as void.", "data-speed=30000")
+            messages.success(
+                request, f"Invoice {invoice.invoice_number} was successfully marked as void.", "data-speed=30000"
+            )
 
+    @transaction.atomic
     def delete_invoice(self, invoice: Invoice, request: HttpRequest):
+        if hasattr(invoice.project_details.project, "projectprepaymentdetail"):
+            invoice.project_details.project.projectprepaymentdetail.restore_funds(invoice, request)
         invoice.delete()
         messages.success(request, f"Invoice {invoice.invoice_number} was successfully deleted.", "data-speed=30000")
 
     def get_deleted_objects(self, invoices: Iterable[Invoice], request: HttpRequest, admin_site):
         # Function to potentially return additional objects to delete, shown in the admin delete page.
         return get_deleted_objects(invoices, request, admin_site)
 
@@ -392,14 +416,23 @@
             )
             tax.summary_item_type = InvoiceSummaryItem.InvoiceSummaryItemType.TAX
             tax_amount = charges_amount * invoice.configuration.tax_amount()
             tax.amount = tax_amount
             summaries.append(tax)
 
         invoice.total_amount = charges_amount + tax_amount
+
+        if hasattr(invoice.project_details.project, "projectprepaymentdetail"):
+            prepayment = invoice.project_details.project.projectprepaymentdetail
+            fund_summaries = prepayment.invoice_fund_summaries(invoice)
+            total_fund_used = Decimal(0)
+            for fund_summary in fund_summaries:
+                summaries.append(fund_summary)
+                total_fund_used += fund_summary.amount
+            invoice.total_amount = invoice.total_amount + total_fund_used
         return summaries
 
     def get_summary_items_for_facility(self, invoice: Invoice, core_facility: str, details) -> List[InvoiceSummaryItem]:
         facility_summaries: List[InvoiceSummaryItem] = []
         for billable_type in BillableItemType:
             items = [item for item in details if item.item_type == billable_type.value]
             facility_summaries.extend(self.get_recap_usage_summary(invoice, core_facility, items))
```

## NEMO_billing/invoices/renderers.py

```diff
@@ -1,14 +1,13 @@
 import importlib
 from abc import ABC, abstractmethod
 from decimal import Decimal
 from io import BytesIO, IOBase
 from typing import Any, List, Tuple
 
-from NEMO.exceptions import InvalidCustomizationException
 from NEMO.utilities import BasicDisplayTable
 from NEMO.views.customization import ApplicationCustomization, ProjectsAccountsCustomization
 from django.conf import settings
 from django.db.models import Sum
 from django.utils import timezone
 
 from NEMO_billing.invoices.exceptions import (
@@ -253,14 +252,26 @@
                 [
                     (tax_item.name, category_name_style),
                     tax_item.details or "",
                     (display_amount(tax_item.amount, invoice.configuration), category_amount_style),
                 ]
             )
 
+        fund_items = invoice.invoicesummaryitem_set.filter(
+            summary_item_type=InvoiceSummaryItem.InvoiceSummaryItemType.FUND
+        )
+        for fund_summary in fund_items:
+            table_data.append(
+                [
+                    (fund_summary.name, category_name_style),
+                    "", # Don't show details for Fund (it contains the id)
+                    (display_amount(fund_summary.amount, invoice.configuration), category_amount_style),
+                ]
+            )
+
         table_data.append(
             [
                 ("Grand Total", category_name_style),
                 "",
                 (display_amount(invoice.total_amount, invoice.configuration), total_amount_style),
             ]
         )
@@ -519,21 +530,30 @@
                 }
             )
         for tax in invoice.invoicesummaryitem_set.filter(
             summary_item_type=InvoiceSummaryItem.InvoiceSummaryItemType.TAX
         ):
             self.document.add_row(
                 {
-                    self.PROJECT_ID_KEY: invoice.project_details.project.application_identifier,
                     self.FACILITY_KEY: tax.core_facility,
                     self.ITEM_TYPE_KEY: tax.get_item_type_display(),
                     self.ITEM_KEY: tax.name,
                     self.AMOUNT_KEY: tax.amount,
                 }
             )
+        for fund in invoice.invoicesummaryitem_set.filter(
+            summary_item_type=InvoiceSummaryItem.InvoiceSummaryItemType.FUND
+        ):
+            self.document.add_row(
+                {
+                    self.ITEM_TYPE_KEY: fund.get_item_type_display(),
+                    self.ITEM_KEY: fund.name,
+                    self.AMOUNT_KEY: fund.amount,
+                }
+            )
         self.document.add_row({self.ITEM_KEY: "Total", self.AMOUNT_KEY: invoice.total_amount})
 
     def close_document(self, invoice: Invoice, document: BasicDisplayTable, file_bytes: IOBase):
         # write the bytes and let the parent class return it
         file_bytes = BytesIO(document.to_csv().content)
         return super().close_document(invoice, document, file_bytes)
```

## NEMO_billing/invoices/urls.py

```diff
@@ -19,14 +19,15 @@
     path("invoices/<int:invoice_id>/send/", invoices.send_invoice, name="send_invoice"),
     path("invoices/<int:invoice_id>/void/", invoices.void_invoice, name="void_invoice"),
     path("invoices/<int:invoice_id>/delete/", invoices.delete_invoice, name="delete_invoice"),
     path("invoices/<int:invoice_id>/csv/", invoices.csv_invoice, name="csv_invoice"),
     path("invoices/<int:invoice_id>/re_render/", invoices.re_render_invoice, name="re_render_invoice"),
     path("invoices/zip/", invoices.zip_invoices, name="zip_invoices"),
     re_path(r"invoices/zip/(?P<file_type>csv)/$", invoices.zip_invoices, name="zip_invoices"),
+    path("invoices/review_and_send/", invoices.review_and_send_invoices, name="review_and_send_invoices"),
     path("invoices/generate_monthly_invoices/", invoices.generate_monthly_invoices, name="generate_monthly_invoices"),
     path("invoice_payment/<int:invoice_id>/received", invoices.invoice_payment_received, name="invoice_payment_received"),
     path("invoice_payment/<int:payment_id>/processed", invoices.invoice_payment_processed, name="invoice_payment_processed"),
 
     # Overriding NEMO's create project URLs
     path("create_project/", project.edit_project, name='invoices_create_project'),
     path("projects/<int:project_id>/edit/", project.edit_project, name='invoices_edit_project'),
```

## NEMO_billing/invoices/migrations/0002_version_1_2_0.py

```diff
@@ -49,10 +49,10 @@
             model_name='invoicesummaryitem',
             name='item_type',
             field=models.IntegerField(blank=True, choices=[(1, 'tool_usage'), (2, 'area_access'), (3, 'consumable'), (4, 'missed_reservation'), (5, 'staff_charge'), (6, 'training_session'), (7, 'custom_charge')], null=True),
         ),
         migrations.AlterField(
             model_name='invoicesummaryitem',
             name='summary_item_type',
-            field=models.IntegerField(choices=[(1, 'item'), (2, 'sub_total'), (3, 'discount_sub_total'), (4, 'discount'), (5, 'tax'), (6, 'other')]),
+            field=models.IntegerField(choices=[(1, 'item'), (2, 'sub_total'), (3, 'discount_sub_total'), (4, 'discount'), (5, 'tax'), (6, 'other'), (7, 'fund')]),
         ),
     ]
```

## NEMO_billing/invoices/static/invoices/invoices.css

```diff
@@ -10,14 +10,15 @@
 {
     display: none;
 }
 
 .invoice-summary-category .summary-item-name,
 .invoice-summary-sub_total .summary-item-name,
 .invoice-summary-discount .summary-item-name,
+.invoice-summary-fund .summary-item-name,
 .invoice-summary-tax .summary-item-name
 {
     font-weight: bold;
 }
 
 .detail-item-amount, .summary-item-amount
 {
```

## NEMO_billing/invoices/templates/invoices/invoice.html

```diff
@@ -127,25 +127,25 @@
 						<td class="summary-item-name">{{ facility|default_if_none:'General Charges' }}</td>
 						<td></td>
 						<td class="summary-item-amount"></td>
 					</tr>
 					{% for summary_item in invoice.summary_dict|get_item:facility %}
 						<tr class="invoice-summary-{% if facility %}facility{% else %}general{% endif %} invoice-summary-{{ summary_item.get_summary_item_type_display }}">
 							<td class="summary-item-name">{% if summary_item.category_name_for_item_type %}{{ summary_item.category_name_for_item_type }} - {% endif %}{{ summary_item.name|default_if_none:'' }}</td>
-							<td>{{ summary_item.details|default_if_none:'' }}</td>
+							<td>{% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}</td>
 							<td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
 						</tr>
 					{% endfor %}
 				{% endfor %}
 				{# Add general summary items here if there were not added before as part of facility summary items #}
 				{% if None not in invoice.sorted_core_facilities %}
 					{% for summary_item in invoice.summary_dict|get_item:None %}
 						<tr class="invoice-summary-{{ summary_item.get_summary_item_type_display }}">
 							<td class="summary-item-name">{{ summary_item.name|default_if_none:'' }}</td>
-							<td>{{ summary_item.details|default_if_none:'' }}</td>
+							<td>{% if summary_item.get_summary_item_type_display != 'fund' %}{{ summary_item.details|default_if_none:'' }}{% endif %}</td>
 							<td class="summary-item-amount">{{ summary_item.amount_display|default_if_none:'' }}</td>
 						</tr>
 					{% endfor %}
 				{% endif %}
 				<tr class="invoice-summary-category">
 					<td class="summary-item-name">Grand Total</td>
 					<td></td>
```

### html2text {}

```diff
@@ -59,30 +59,31 @@
 type="warn" size="small" value="Re-render invoice file" onclick="show_spinner
 ();" url=re_render_url icon="glyphicon-refresh" %} {% endif %}
     * Summary
     * Details
     * Payments
 {% url 'csv_invoice' invoice.id as export_csv_url %} {% button type="export"
 value="Export data in CSV" url=export_csv_url %}
-Item                                     Details                               Amount
+Item                                     Details                                    Amount
 {{ facility|default_if_none:'General
 Charges' }}
 {% if
-summary_item.category_name_for_item_type
-%}{                                      {                                     {
-{                                        {                                     {
-summary_item.category_name_for_item_type summary_item.details|default_if_none: summary_item.amount_display|default_if_none:
-}} - {% endif %}{                        '' }}                                 '' }}
+summary_item.category_name_for_item_type {% if
+%}{                                      summary_item.get_summary_item_type_display {
+{                                        != 'fund' %}{                              {
+summary_item.category_name_for_item_type { summary_item.details|default_if_none:''  summary_item.amount_display|default_if_none:
+}} - {% endif %}{                        }}{% endif %}                              '' }}
 { summary_item.name|default_if_none:''
 }}
-                                         {                                     {
-{{ summary_item.name|default_if_none:''  {                                     {
-}}                                       summary_item.details|default_if_none: summary_item.amount_display|default_if_none:
-                                         '' }}                                 '' }}
-Grand Total                                                                    {{ invoice.total_amount_display }}
+                                         {% if                                      {
+{{ summary_item.name|default_if_none:''  summary_item.get_summary_item_type_display {
+}}                                       != 'fund' %}{                              summary_item.amount_display|default_if_none:
+                                         { summary_item.details|default_if_none:''  '' }}
+                                         }}{% endif %}
+Grand Total                                                                         {{ invoice.total_amount_display }}
 {% for core_facility, items in invoice.details_dict.items %}
 {{ core_facility|default_if_none:"General charges" }}
 {% include 'invoices/invoice_details.html' with items=items|get_item:
 'tool_usage' key='tool_usage' title=tool_title %} {% include 'invoices/
 invoice_details.html' with items=items|get_item:'area_access' key='area_access'
 title=area_title %} {% include 'invoices/invoice_details.html' with
 items=items|get_item:'staff_charges' key='staff_charges'
```

## NEMO_billing/invoices/templates/invoices/invoices.html

```diff
@@ -69,18 +69,21 @@
 				<div class="col-xs-12 col-sm-6 {% if configuration_list|length_is:1 %}col-md-3 col-sm-offset-6 col-md-offset-0{% else %}col-md-4 col-md-offset-8{% endif %} text-right" style="margin-bottom: 15px; padding-right:0;">
 					{% button type="save" onclick="show_spinner(this.form);" value="Generate invoice(s)" icon="glyphicon-list-alt" %}
 				</div>
 			</form>
 		{% endif %}
 		<div id="download_invoices" class="row" style="display: none; margin-top: 15px; margin-right: 0">
 			<div class="form-group">
+				{% url 'review_and_send_invoices' as review_and_send_url %}
 				{% url 'zip_invoices' 'csv' as zip_csv_url %}
 				{% url 'zip_invoices' as zip_url %}
-				{% button type="export" style="margin-left: 10px; float: right;" value="Export selected invoices (CSV)" onclick="$('#zip-invoices').attr('action', '"|concat:zip_csv_url|concat:"');$('#zip-invoices').submit();$('#zip-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
-				{% button type="export" style="float: right;" value="Export selected invoices" onclick="$('#zip-invoices').attr('action', '"|concat:zip_url|concat:"');$('#zip-invoices').submit();$('#zip-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+				{% button type="export" style="margin-left: 10px; float: right;" value="Review and send" onclick="$('#selected-invoices').attr('action', '"|concat:review_and_send_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+				{% button type="export" style="margin-left: 10px; float: right;" value="Export (CSV)" onclick="$('#selected-invoices').attr('action', '"|concat:zip_csv_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+				{% button type="export" style="float: right;" value="Export" onclick="$('#selected-invoices').attr('action', '"|concat:zip_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+				<label class="pull-right control-label form-control-static" style="margin-right: 10px;">Selected invoices: </label>
 			</div>
 		</div>
 	{% endif %}
 {% endblock %}
 {% block pagination_header %}
 	<div class="row" style="width: 100%; margin: 20px 0;">
 		{% regroup filter_month_list by year as filter_by_year %}
@@ -103,20 +106,20 @@
 		{% endif %}
 		<div class="col-xs-5 col-sm-4 col-lg-2 text-right" style="padding-right: 0">
 			{% include "pagination/pagination_selector.html" %}
 		</div>
 	</div>
 {% endblock %}
 {% block pagination_content %}
-	<form id="zip-invoices" action="{% url 'zip_invoices' %}" method="post">
+	<form id="selected-invoices" action="{% url 'zip_invoices' %}" method="post">
 		{% csrf_token %}
 		<table class="table table-bordered table-condensed table-striped table-hover thead-light">
 			<thead>
 				<tr>
-					<th class="button-column-minimum"><input type="checkbox" onchange="$('#zip-invoices :checkbox').prop('checked', $(this).prop('checked'));update_download_button_state();"></th>
+					<th class="button-column-minimum"><input type="checkbox" onchange="$('#selected-invoices :checkbox').prop('checked', $(this).prop('checked'));update_download_button_state();"></th>
 					<th class="button-column-minimum">{% include 'pagination/pagination_column.html' with order_by='invoice_number' name='#' %}</th>
 					{% if "created_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='created_date' name='Created' %}</th>{% endif %}
 					{% if "month" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='start' name='Month' %}</th>{% endif %}
 					<th>{% include 'pagination/pagination_column.html' with order_by='project_details__project__name' name='Project' %}</th>
 					<th>{% include 'pagination/pagination_column.html' with order_by='project_details__project__account__name' name='Account' %}</th>
 					{% if "sent_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='last_sent_date' name='Sent' %}</th>{% endif %}
 					{% if "due_date" not in hide_columns %}<th>{% include 'pagination/pagination_column.html' with order_by='due_date' name='Due' %}</th>{% endif %}
@@ -138,17 +141,17 @@
 						<tr>
 							<td class="text-center"><input type="checkbox" id="select_{{ invoice.id }}" name="selected_invoice_id[]" aria-label="{{ invoice.invoice_number }}" value="{{ invoice.id }}" onchange="update_download_button_state();"/></td>
 							<td style="white-space: nowrap"><label for="select_{{ invoice.id }}">{{ invoice.invoice_number }}</label></td>
 							{% if "created_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.created_date|date:"SHORT_DATETIME_FORMAT" }}</td>{% endif %}
 							{% if "month" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.start|date:"F Y" }}</td>{% endif %}
 							<td {{ td_attribute|safe }}>{{ invoice.project_details.project.name }}</td>
 							<td {{ td_attribute|safe }}>{{ invoice.project_details.project.account.name }}</td>
-							{% if "sent_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.last_sent_date|date|default_if_none:"" }}</td>{% endif %}
-							{% if "due_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.due_date|date|default_if_none:"" }}</td>{% endif %}
-							{% if "review_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.reviewed_date|date|default_if_none:"" }}</td>{% endif %}
+							{% if "sent_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.last_sent_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
+							{% if "due_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.due_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
+							{% if "review_date" not in hide_columns %}<td {{ td_attribute|safe }}>{{ invoice.reviewed_date|date:"SHORT_DATE_FORMAT"|default_if_none:"" }}</td>{% endif %}
 							<td {{ td_attribute|safe }} class="text-right">{{ invoice.total_amount_display }}</td>
 							{% for core_facility in core_facilities %}
 								<td {{ td_attribute|safe }} class="text-right">
 								{% with facility_subtotal=invoice.facility_subtotals|to_dict:"core_facility"|get_item:core_facility.name %}
 									{{ facility_subtotal.amount|default:0|display_amount:invoice.configuration }}
 								{% endwith %}
 								</td>
@@ -179,15 +182,15 @@
 		<i>No invoices could be found.</i>
 	</div>
 {% endblock %}
 {% block after_pagination %}
 	<script>
 		function update_download_button_state()
 		{
-			if ($("#zip-invoices input:checkbox:checked").length > 0)
+			if ($("#selected-invoices input:checkbox:checked").length > 0)
 			{
 				$('#download_invoices').show();
 			}
 			else
 			{
 				$('#download_invoices').hide();
 			}
```

### html2text {}

```diff
@@ -30,23 +30,28 @@
 {% for configuration in configuration_list %}
 {{ configuration.name }}
 {% endfor %}
 {% endif %}
 {% button type="save" onclick="show_spinner(this.form);" value="Generate
 invoice(s)" icon="glyphicon-list-alt" %}
 {% endif %}
-{% url 'zip_invoices' 'csv' as zip_csv_url %} {% url 'zip_invoices' as zip_url
-%} {% button type="export" style="margin-left: 10px; float: right;"
-value="Export selected invoices (CSV)" onclick="$('#zip-invoices').attr
-('action', '"|concat:zip_csv_url|concat:"');$('#zip-invoices').submit();$
-('#zip-invoices :checkbox').prop('checked', false);update_download_button_state
-();" %} {% button type="export" style="float: right;" value="Export selected
-invoices" onclick="$('#zip-invoices').attr('action', '"|concat:zip_url|concat:
-"');$('#zip-invoices').submit();$('#zip-invoices :checkbox').prop('checked',
-false);update_download_button_state();" %}
+{% url 'review_and_send_invoices' as review_and_send_url %} {% url
+'zip_invoices' 'csv' as zip_csv_url %} {% url 'zip_invoices' as zip_url %} {%
+button type="export" style="margin-left: 10px; float: right;" value="Review and
+send" onclick="$('#selected-invoices').attr('action', '"|concat:
+review_and_send_url|concat:"');$('#selected-invoices').submit();$('#selected-
+invoices :checkbox').prop('checked', false);update_download_button_state();" %}
+{% button type="export" style="margin-left: 10px; float: right;" value="Export
+(CSV)" onclick="$('#selected-invoices').attr('action', '"|concat:
+zip_csv_url|concat:"');$('#selected-invoices').submit();$('#selected-invoices :
+checkbox').prop('checked', false);update_download_button_state();" %} {% button
+type="export" style="float: right;" value="Export" onclick="$('#selected-
+invoices').attr('action', '"|concat:zip_url|concat:"');$('#selected-
+invoices').submit();$('#selected-invoices :checkbox').prop('checked',
+false);update_download_button_state();" %} Selected invoices:
 {% endif %} {% endblock %} {% block pagination_header %}
 {% regroup filter_month_list by year as filter_by_year %} {% if
 filter_month_list %}
 {% for year in filter_by_year %} {{ year.grouper }} {% endfor %} {% if
 filter_month %}
  Clear
 {% endif %}
```

## NEMO_billing/invoices/views/invoices.py

```diff
@@ -308,14 +308,24 @@
     if not invoice_ids:
         return redirect("invoices")
     else:
         return zip_response(request, Invoice.objects.filter(id__in=invoice_ids), file_type)
 
 
 @accounting_or_user_office_or_manager_required
+@require_POST
+def review_and_send_invoices(request):
+    invoice_ids: List[str] = request.POST.getlist("selected_invoice_id[]")
+    for invoice_id in invoice_ids:
+        review_invoice(request, invoice_id)
+        send_invoice(request, invoice_id)
+    return redirect("invoices")
+
+
+@accounting_or_user_office_or_manager_required
 @require_GET
 def re_render_invoice(request, invoice_id):
     invoice = get_object_or_404(Invoice, pk=invoice_id)
     try:
         if invoice.file:
             messages.warning(request, "This invoice already has a rendered invoice on file")
         else:
```

## NEMO_billing/invoices/views/project.py

```diff
@@ -122,15 +122,15 @@
     send_project_expiration_reminders()
     return HttpResponse()
 
 
 def send_project_expiration_reminders():
     accounting_email = BillingCustomization.get("billing_accounting_email_address")
     expiration_reminder_days = BillingCustomization.get("billing_project_expiration_reminder_days")
-    if accounting_email and expiration_reminder_days:
+    if expiration_reminder_days:
         project_expiration_reminder_cc = BillingCustomization.get("billing_project_expiration_reminder_cc")
         ccs = [e for e in project_expiration_reminder_cc.split(",") if e]
         for remaining_days in [int(days) for days in expiration_reminder_days.split(",")]:
             expiration_date = date.today() + timedelta(days=remaining_days)
             for project in Project.objects.filter(active=True, projectbillingdetails__expires_on=expiration_date):
                 send_to = project.projectbillingdetails.email_to()
                 if send_to:
```

## NEMO_billing/invoices/views/usage.py

```diff
@@ -106,15 +106,14 @@
                 user_filter = user_filter & Q(user=user)
                 trainee_filter = trainee_filter & Q(trainee=user)
             detailed_items = sorted_billable_items(start, end, config, customer_filter, user_filter, trainee_filter)
             if bool(request.GET.get("csv", False)):
                 return csv_export_response(detailed_items)
     except Exception as e:
         logger.exception(e)
-        pass
     total_charges = sum(item.billable_amount for item in detailed_items)
     dictionary = {
         "search_items": set(Account.objects.all())
         | set(Project.objects.all())
         | set(get_project_applications())
         | set(User.objects.filter(is_active=True)),
         "detailed_items": detailed_items,
```

## NEMO_billing/rates/apps.py

```diff
@@ -7,15 +7,15 @@
 for name in dir(defaults):
     if name.isupper() and not hasattr(settings, name):
         setattr(settings, name, getattr(defaults, name))
 
 
 class NEMORatesConfig(AppConfig):
     name = "NEMO_billing.rates"
-    verbose_name = "Rates"
+    verbose_name = "Billing Rates"
     default_auto_field = "django.db.models.AutoField"
 
     def ready(self):
         # Remove the rates customization coming from regular NEMO since we have our own
         from NEMO.views.customization import CustomizationBase
 
         if "rates" in CustomizationBase._instances:
```

## NEMO_billing/templates/base/navbar_billing.html

```diff
@@ -1,7 +1,14 @@
 {% load static %}
 {% load custom_tags_and_filters %}
 {% if user.is_any_part_of_staff %}
 	{% navigation_url 'custom_charges' 'Custom charges' user.is_user_office user.is_accounting_officer user.is_manager user.is_superuser %}
 	{% navigation_url 'invoices' 'Invoices' user.is_user_office user.is_accounting_officer user.is_manager user.is_superuser %}
 	{% navigation_url 'rates' 'Rates' user.is_accounting_officer user.is_manager user.is_superuser %}
+	{% if "NEMO_billing.prepayments"|app_installed and "NEMO_billing.cap_discount"|app_installed %}
+		{% navigation_url 'prepaid_project_status' 'CAP and prepaid status' user.is_accounting_officer user.is_manager user.is_superuser %}
+	{% elif "NEMO_billing.prepayments"|app_installed %}
+		{% navigation_url 'prepaid_project_status' 'Prepaid project status' user.is_accounting_officer user.is_manager user.is_superuser %}
+	{% elif "NEMO_billing.cap_discount"|app_installed %}
+		{% navigation_url 'cap_discount_status' 'CAP status' user.is_accounting_officer user.is_manager user.is_superuser %}
+	{% endif %}
 {% endif %}
```

## NEMO_billing/tests/test_settings.py

```diff
@@ -32,14 +32,15 @@
     "django.contrib.staticfiles",
     "django.contrib.admin",
     "django.contrib.humanize",
     "NEMO_billing",
     "NEMO_billing.rates",
     "NEMO_billing.invoices",
     "NEMO_billing.cap_discount",
+    "NEMO_billing.prepayments",
     "NEMO",
     "NEMO.apps.kiosk",
     "NEMO.apps.area_access",
     "rest_framework",
     "django_filters",
     "mptt",
 ]
```

## NEMO_billing/tests/cap/test_cap_discount.py

```diff
@@ -63,17 +63,17 @@
         cap_tier.amount = Decimal(0)
         self.assertRaises(ValidationError, cap_tier.full_clean)
         cap_tier.amount = Decimal("1")
         cap_tier.full_clean()
         # No discount
         cap_tier.discount = None
         self.assertRaises(ValidationError, cap_tier.full_clean)
-        # Basically the same as no discount
+        # This is intentional, since it could be a higher tier with no discount
         cap_tier.discount = Decimal(0)
-        self.assertRaises(ValidationError, cap_tier.full_clean)
+        cap_tier.full_clean()
         # Cannot have more than 100% discount
         cap_tier.discount = Decimal("101")
         self.assertRaises(ValidationError, cap_tier.full_clean)
         # 100% ok
         cap_tier.discount = Decimal("100")
         cap_tier.full_clean()
         # Start date is required when not starting on first eligible charge
@@ -275,14 +275,15 @@
             # now ok
             custom_charge.full_clean()
         with self.modify_settings(INSTALLED_APPS={"remove": "NEMO_billing.cap_discount"}):
             # reset
             custom_charge.core_facility = None
             self.cap_configuration.core_facility = None
             # Even with staff as custom charge, it doesn't matter since cap_discount is not installed
+            self.staff.projects.add(self.project)
             custom_charge.customer = self.staff
             custom_charge.full_clean()
             # also fine with different facility
             custom_charge.core_facility = facility
             custom_charge.full_clean()
 
     def test_cap_amounts(self):
@@ -328,16 +329,16 @@
     def test_all_types_of_charges(self):
         # Test each charge
         for billable_type in BillableItemType:
             with self.subTest(billable_type.name):
                 self.charges_subtest([billable_type])
                 delete_all_billables()
         # Test combination of charges
-        for i in range(1, 7):
-            for j in range(i + 1, 7):
+        for i in range(1, 8):
+            for j in range(i + 1, 8):
                 with self.subTest(f"{BillableItemType(i).name}-{BillableItemType(j).name}"):
                     self.charges_subtest([BillableItemType(i), BillableItemType(j)])
                     delete_all_billables()
 
     def charges_subtest(self, billable_charge_types: List[BillableItemType]):
         # Reset start date and amounts
         cap_configuration = self.cap_configuration
```

## NEMO_billing/tests/cap/test_cap_utilities.py

```diff
@@ -19,15 +19,15 @@
 
 
 def create_items() -> (Tool, Area, Consumable, User):
     consumable = Consumable.objects.create(name="Tweezers", quantity=10, reusable=True)
     consumable_type = RateType.objects.get(type="CONSUMABLE")
     rate_category = RateCategory.objects.get(name="Academia")
     Rate.objects.create(category=rate_category, type=consumable_type, consumable=consumable, flat=True, amount="20.00")
-    tool = Tool.objects.create(name="Tool")
+    tool = Tool.objects.create(name="Tool", _operational=True)
     tool_type = RateType.objects.get(type="TOOL_USAGE")
     Rate.objects.create(category=rate_category, type=tool_type, tool=tool, amount="30.00")
     area = Area.objects.create(name="Area")
     area_type = RateType.objects.get(type="AREA_USAGE")
     Rate.objects.create(category=rate_category, type=area_type, area=area, amount="40.00")
     staff = User.objects.create(username="staff", first_name="Staff", last_name="Staff", is_staff=True, badge_number=2)
     tool_missed_resa_type = RateType.objects.get(type="TOOL_MISSED_RESERVATION")
```

## Comparing `NEMO_billing-2.4.0.dist-info/LICENSE` & `NEMO_billing-2.5.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `NEMO_billing-2.4.0.dist-info/METADATA` & `NEMO_billing-2.5.0.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: NEMO-billing
-Version: 2.4.0
+Version: 2.5.0
 Summary: Install Billing plugin for NEMO
 Home-page: https://gitlab.com/nemo-community/atlantis-labs/nemo-billing
 Author: Atlantis Labs LLC
 Author-email: atlantis@atlantislabs.io
 License: MIT
 Keywords: NEMO
 Classifier: Development Status :: 4 - Beta
```

## Comparing `NEMO_billing-2.4.0.dist-info/RECORD` & `NEMO_billing-2.5.0.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,94 +1,107 @@
 NEMO_billing/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/admin.py,sha256=5X6ZtK7_8Ri3yJDzYU1REYmpFN92ApFfu2woKIlYy1o,14038
 NEMO_billing/api.py,sha256=17woqDdYhTtAMGu9wx8zOCegtfSU6cnarKbMr9fLUIs,2638
 NEMO_billing/app_settings.py,sha256=jFpLL7MGspdYud_InbxiMN_8u5TYj7lubZDSb9Muvzk,285
 NEMO_billing/apps.py,sha256=5FpuGePoZ5KLQakfMeAFrImcKYAognKgpX6xojaFGmE,426
 NEMO_billing/decorators.py,sha256=bJ9hxj4HPvE20RD7pFLNTevdqw9oCgjgQpCe8dtgxtY,199
 NEMO_billing/exceptions.py,sha256=7QPSpX-yzxrchSJyo08JNQ0Oq7BhqDQYsdX2nqECZ_8,122
-NEMO_billing/models.py,sha256=D7zvURDdtKJO5plgF13vrrB5NufXBeGCB1K2aSjzcWs,5375
+NEMO_billing/models.py,sha256=OKxEeTKz_MHVvUZrTjNlct_UIrxGxlEF1e88jEjPDZs,5728
 NEMO_billing/urls.py,sha256=gG8IecGrOpICJ5im995I54iHvM7VaFVAgUAJxmFTiSI,1304
-NEMO_billing/utilities.py,sha256=0b0SiH8JQa9wsQpHOve1iYrdLJZCoo4yBRqLl0w2M0Q,417
-NEMO_billing/views.py,sha256=BmyfqosAufO6Yg4v1q3DNhYSo04jK_buG23i6Edadgg,6261
+NEMO_billing/utilities.py,sha256=pwy3Pszgic0-EfQ7X67_nTbi3zlaewJJ3quMWjI4NCM,3111
+NEMO_billing/views.py,sha256=aHq58PQA_LtRJAEpl_WhqoxNCUUTEumEUAr41092C2Q,6371
 NEMO_billing/cap_discount/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/cap_discount/admin.py,sha256=04B5-scRAO8YD3cEeDDin3I1TigZFwXu2QpF5GtsxOk,6046
+NEMO_billing/cap_discount/admin.py,sha256=ByEEW-QWgcGpNJXoa1jEkWZMMV7YgKDYlPshfxAVuis,4880
 NEMO_billing/cap_discount/app_settings.py,sha256=IEX-9f0PfxBuyfNVN0AAUjB6EX7S8WNhQCCjhoWQF2c,102
-NEMO_billing/cap_discount/apps.py,sha256=HD43VTYDOYttkLm9SLWBow5IoA2QTPj06_5S4hNw7Ew,436
+NEMO_billing/cap_discount/apps.py,sha256=F1TsLrQW4tSz593Efiwu6_TkagWb0CCmBpPHpvTNPSI,444
 NEMO_billing/cap_discount/customization.py,sha256=HmMpI90MXbO44I8uCrVYSH35RSVfGstC-oN3FVkZp2w,2991
 NEMO_billing/cap_discount/exceptions.py,sha256=IGvQo-7iBf19v87KIMkiH6kW2QIMydOp4qQLctKisQY,892
-NEMO_billing/cap_discount/models.py,sha256=D-HOiWKKU5vbunKcj_MwtF7DoFmonYK6Cg4B0qqkvno,18242
-NEMO_billing/cap_discount/processors.py,sha256=e0cHAIzvAC7T0x6FyuGnoGqadQwfR_y4ez_xp1sVy0M,20948
-NEMO_billing/cap_discount/urls.py,sha256=0-RVPw8T_fYY9M2Uy_o1vARfdlqRw0mcRd_wC5w5ml4,461
-NEMO_billing/cap_discount/views.py,sha256=Bzq1My6tEFXjq1stBXJa5erdZfrdIbq-3KKITQs1yMA,1280
+NEMO_billing/cap_discount/models.py,sha256=dNeLZJx8NtHtqoszBcifI13riLE8qUGCZOxwWB0gMnU,18130
+NEMO_billing/cap_discount/processors.py,sha256=5b9rK9XlhIa3TFg1PDBS3q9Vxk1hZyMWoYASCglTd74,21607
+NEMO_billing/cap_discount/urls.py,sha256=ehNh3089Fvmr-cfpn0oUy1rAGDqAxtGmkrRQfh6GNfo,550
+NEMO_billing/cap_discount/views.py,sha256=6bmzdyCRq7zNe7lw9vGUledqkxviGDduCl1FPSMvHwQ,1706
 NEMO_billing/cap_discount/migrations/0001_initial.py,sha256=DUzD7P1ojLrfj47u_a6ueopG1sL3Yjv9eEC46GGZrxQ,7568
 NEMO_billing/cap_discount/migrations/0002_version_2_0_0.py,sha256=Ch6EXpvFjakBma6mRYLT6KRZQOanNWguVxxwX7jUqdo,1665
-NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py,sha256=OCqXDrilXJd61cutIyHhluM20Um7o1j6OiSC9fADDcI,4815
+NEMO_billing/cap_discount/migrations/0003_multi_tier_discount.py,sha256=JF7nMLzShWLyYGw8EPYxSgHHJZWRrXpiLAC9nRBVO2U,4815
 NEMO_billing/cap_discount/migrations/0004_shortened_unique_constraints.py,sha256=OWXzH4H_-xZf9X4qoZm2-Xw6SgMxq1LZPQWMlx9PZCY,3478
 NEMO_billing/cap_discount/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html,sha256=CPHDcOCT83RexvEQxk2y-fAoTtPotqL-Piu8C2Bh_Uo,1664
+NEMO_billing/cap_discount/templates/cap_discount/cap_discount_status.html,sha256=ZQYIHr0ISGVSt1LtGmSDj_aK8GLSjR59DDfp5ngL03s,1415
+NEMO_billing/cap_discount/templates/cap_discount/usage_cap_discounts.html,sha256=uUyAyi_2XYy_xYcHp--og5Wk-B0qIGGJ0kHy1pgvnDM,1772
 NEMO_billing/cap_discount/templates/customizations/customizations_cap_discount.html,sha256=Wfhx7faoFJtiS_6iZdllohBFtcFDu6STfwOP1z7jf50,4068
 NEMO_billing/invoices/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/invoices/admin.py,sha256=e5SCy5Qis-G0BB51EeGdCospnginHdvqvX_s8jDTj3c,10561
+NEMO_billing/invoices/admin.py,sha256=2u74fK64VdbngmXMUJwnxr8MO7jr8W89lqNGaTvjqZg,10823
 NEMO_billing/invoices/api.py,sha256=8XEbpeNYIeyX4GeOo8V57mXBVNPefFi2LF2xZd3NEP4,7049
 NEMO_billing/invoices/app_settings.py,sha256=xCnFmkrrdKZR3Y10fP9goyBYEF6IgxRU822du8gQ9Io,176
-NEMO_billing/invoices/apps.py,sha256=LsmoLy06jnQ1siQ9WuCzWLAeBnwdwdpU4XNgAjwD6Uo,437
+NEMO_billing/invoices/apps.py,sha256=GeE88lnFhWikhxJyY1sPECwrrQr2qk72tfn1QhTlQSs,445
 NEMO_billing/invoices/customization.py,sha256=nweZVRuLEDHKMj1SLT0MwDjAbcR2kSiHscO7eF4oFdc,4448
 NEMO_billing/invoices/exceptions.py,sha256=vxqszGM-qTiHGuIXNjIK93Incg-cMpY8nHC89l92Imk,2642
-NEMO_billing/invoices/models.py,sha256=Ozo17X8Q9J4a7bIydMeJ30NJCWXcyY4wLIe4nN3T8VY,23292
+NEMO_billing/invoices/models.py,sha256=F9IQBr_6gi7raXKxMwFAwKnBc4jYXVltcKSN87mDrjw,23629
 NEMO_billing/invoices/pdf_utilities.py,sha256=k9NKkO40tce4ALJl1LPMmy6JT7FnXcHmIG-08tYZYSA,12477
-NEMO_billing/invoices/processors.py,sha256=SMjYZakh0VgJ27iWRmBXHHmXWPkklBWL7Lcjv0duGdQ,28706
-NEMO_billing/invoices/renderers.py,sha256=f-xQI-EgZIq8fvPDe8Y9ca0d0LJlofvM1_RYRWRmtsc,25415
-NEMO_billing/invoices/urls.py,sha256=qpa7bgpQ8GUUbf9X4tG5XVs06s5_iV7ZBJpjb10_wg4,2937
+NEMO_billing/invoices/processors.py,sha256=Mi7Fays1UEf7CiPO7b3y-OITnXXEexVjWNUSVHTDRa4,30163
+NEMO_billing/invoices/renderers.py,sha256=C73ZZbZHjBiM17LLZhODQpLsV6_GDk5e5BdrIRBCjqA,26169
+NEMO_billing/invoices/urls.py,sha256=LVqIWjGyr5IBtfs1KvJ0vIdAuNlpLUEe_2f6WPOc21Q,3044
 NEMO_billing/invoices/utilities.py,sha256=TVLznEJN6B_XzOu1uXUyCTWHkECNcCWBOkbsUM8JYeQ,4235
 NEMO_billing/invoices/management/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/management/commands/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/invoices/management/commands/deactivate_expired_projects.py,sha256=vrJ7y-FHBPvufXCbcYQbOmNwBUsWSSAvdGlYdGX4lII,298
 NEMO_billing/invoices/management/commands/send_invoice_payment_reminder.py,sha256=NirdsT3Saj_sZwCE2iZMHZgMDeXYvp8hL2srk-Z63mY,318
 NEMO_billing/invoices/migrations/0001_initial.py,sha256=9Jg9lZCVb_yksWR4x5dT-h4QQ3oelPx-KgeQ0ktNayc,9795
-NEMO_billing/invoices/migrations/0002_version_1_2_0.py,sha256=LEAOETWMPEu-ZW3mA3AOPvfOTUtRMsHzgADXfMH6uAg,2781
+NEMO_billing/invoices/migrations/0002_version_1_2_0.py,sha256=Rdo1o--uj5fRSYUZ-hk1Ir-UsSTBMfdqbTbBk8jNDvE,2794
 NEMO_billing/invoices/migrations/0003_version_1_4_0.py,sha256=xLvPGSmXUhDQ6ldwKWyeB13jdLU8Gywxr0pSQWIpuRE,1063
 NEMO_billing/invoices/migrations/0004_version_1_6_0.py,sha256=XpY-TXxRiKSmqm5XjO-M-6q5TlgHAXH4TxiA6eVaY6Y,467
 NEMO_billing/invoices/migrations/0005_version_1_6_1.py,sha256=bDdJ5TWTug_hyPmvDw2koOeuH95IRfmwBwgj3uhClOM,485
 NEMO_billing/invoices/migrations/0006_version_1_7_1.py,sha256=pn0XXRQb9IcYCTCQHnOyinoGkbwkbJRMKedcNmmAYk4,518
 NEMO_billing/invoices/migrations/0007_version_1_8_0.py,sha256=Fz-m4Ig4buUJU4QrOUDSFe4brS42qwPwuuXM3Oyz8dY,458
 NEMO_billing/invoices/migrations/0008_version_1_10_0.py,sha256=L_WSEK0zV60RgyKeUswKVNBcFALV4CxCrpQ0RY63i5U,437
 NEMO_billing/invoices/migrations/0009_version_1_23_0.py,sha256=OovlSCBav-NtlFw3EQ2ILuT_nmgOwpeu639Ly0hsmIU,1183
 NEMO_billing/invoices/migrations/0010_version_2_0_0.py,sha256=12oMKisB9Pdclkr85ASTIJJgX2GLeiXJ_Zkctg8RNhM,439
 NEMO_billing/invoices/migrations/0011_version_2_4_0.py,sha256=WrVVESctexdmPvqoH49HFLmWdPCFEcRDnZ-m0AAtjZU,1280
 NEMO_billing/invoices/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/invoices/static/invoices/invoices.css,sha256=muuTqotwZaDbLYodkpQs949MX5_KN5QmXB2X6ndeiAY,1030
+NEMO_billing/invoices/static/invoices/invoices.css,sha256=9HC7rx65WIdIb2GzV2-H204cRKEhqI8tFnAzi6bCwk0,1072
 NEMO_billing/invoices/templates/customizations/customizations_billing.html,sha256=syFjM900RNn7fhT48VC74nXt3YoczEqjLxaT8XFuxHM,5678
 NEMO_billing/invoices/templates/customizations/customizations_invoices.html,sha256=iwrKt38Y_PSBXra1rv44TsdveCSRBshgizedxabNvLM,8157
 NEMO_billing/invoices/templates/invoices/base.html,sha256=GJQiq_yduxal8rnCPLyZsclw7w1G9UAgjSAvgCPf__I,212
-NEMO_billing/invoices/templates/invoices/invoice.html,sha256=ZY8ntYXX5U_1vtUhfMgIrxdbqxVTRmLTo778C3V_R8g,12867
+NEMO_billing/invoices/templates/invoices/invoice.html,sha256=LJwyPbxiLZcQ0GfHRIdSub6dDGuvQNeYFSLVnIoR-cw,13011
 NEMO_billing/invoices/templates/invoices/invoice_details.html,sha256=Tu-dNX7kYZK-NqD8sbJMHDaBwFF36cz_jMUBRHWry8E,3375
-NEMO_billing/invoices/templates/invoices/invoices.html,sha256=NlzSde-igXgguenL5nQHl2T_YiIF0IYBWr7VpRz89Y4,12238
+NEMO_billing/invoices/templates/invoices/invoices.html,sha256=feDg7XHBqw6cD4AFcO7CuUFhPrNG8LMO7sF1hvqvi04,12799
 NEMO_billing/invoices/templates/invoices/usage.html,sha256=bdQpuhbXzqeonEWxrDA0AspWcCqTunnTxVRlX3j13fg,13787
 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_message.html,sha256=Ae3T7dn2Bow-Fyhm4qJpaGnTmFXhfI9I6FwnNIhSNYs,1274
 NEMO_billing/invoices/templates/invoices/email/billing_project_expiration_reminder_email_subject.txt,sha256=B6Qch-uKedCcN7DEUtSub1qCmn-AStVrr433FUg8gLU,173
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_message.html,sha256=qxtmOrntin7s--ejgi0-ZExhMNtlFH5Ug9FDN8HlG1M,1330
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_message.html,sha256=-7pEuk2HGcyKWrQVUq2g-rOJSijl5kHH0qVxy5RhDsU,1344
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_reminder_subject.txt,sha256=CppgdsErLEDyGWDSiupNBwDwYkcQ2yWGHDZIHbZLk84,155
 NEMO_billing/invoices/templates/invoices/email/email_send_invoice_subject.txt,sha256=sqKu9kb_nGdwlwaaFtA_1SrlkDToiQC6DwVpMr79DuA,155
 NEMO_billing/invoices/templates/invoices/project/edit_project.html,sha256=VuOGDfPKFNIEa3w6jv0SR7p8wqY4yF1bDbUGscg--4k,13693
 NEMO_billing/invoices/templates/invoices/project/view_project_additional_info.html,sha256=4Xn4EoEJd15QcH5M_rJ8nr22eUkvyUnPLdMphCWhYJQ,3668
 NEMO_billing/invoices/views/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/invoices/views/invoices.py,sha256=QS_RNbPpRDrocNIy5IUmrQFpaouPDGVWaSfKMW1Z28U,18829
-NEMO_billing/invoices/views/project.py,sha256=C0cc-fSfL6jZUjxwRLLqXDZIzqD6rfhWo6OKRBUi9I4,6929
-NEMO_billing/invoices/views/usage.py,sha256=Erhr-AR_ZsTq2QdmFjP-oWR1utOBjRCkBFu7Jb3DUxw,10654
+NEMO_billing/invoices/views/invoices.py,sha256=F3MvJwiXr4x13AOakuVZlD2xd-jIix_wryAGsqLfqHo,19159
+NEMO_billing/invoices/views/project.py,sha256=Zc7tfV_Ei_waqht29_0_qQmubJBPbR_o3NDgET2ft6I,6908
+NEMO_billing/invoices/views/usage.py,sha256=7rPjX7c7ApcqVXlxJj7AdplXQXpcF9470mGkeZde02Y,10641
 NEMO_billing/migrations/0001_initial.py,sha256=8mX99RBacUkx98feI1gk4ipAncSoGxqHn7uVTShlGM0,3156
 NEMO_billing/migrations/0002_version_1_2_0.py,sha256=L9gAAPwTIPJoVJFgRHvxukVBbJ24i38E7pGWUcPF1Tw,573
 NEMO_billing/migrations/0003_version_2_0_0.py,sha256=bthjpfKPie-Rn0-DFChbJAFTixJhdcWtcMRmeM1hra4,466
 NEMO_billing/migrations/0004_version_2_4_0.py,sha256=w9yF3G7SxpC8Jl7pQzXZr5GgxNWf7j1gFfZwWc8Bmuo,7722
 NEMO_billing/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+NEMO_billing/prepayments/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+NEMO_billing/prepayments/admin.py,sha256=noo3QOVRC7iAMFto5IyYQsxPkVqxWgp5PP6ntpSRzHE,2843
+NEMO_billing/prepayments/app_settings.py,sha256=o19SNbTs_CxC8qS3DeURjz8JTGAVXVIbGdANrpm75Qk,71
+NEMO_billing/prepayments/apps.py,sha256=7tZjsEtswtOj6g8UdDjXgo2yFzObYL4Gw2CG7MNPDY8,559
+NEMO_billing/prepayments/exceptions.py,sha256=GGPuuLWNuNaJy80Lo7E01A1zxJc1ar1bDuxCPLAy8w0,1876
+NEMO_billing/prepayments/models.py,sha256=iRY5Awd_E4Q3WfHUpqP4sfj2a5MbsrGktOJB4btl4JY,17083
+NEMO_billing/prepayments/policy.py,sha256=5li0URkdz0bJjiacdYekSv5ZQTZ2N4CXW84joYKTlok,5142
+NEMO_billing/prepayments/urls.py,sha256=rUMFzI-Iw6zfxeL1n522zIapkjvtbYK5ztNsA45YiFU,204
+NEMO_billing/prepayments/migrations/0001_initial.py,sha256=KLXLxa9hFghBCSR1ciXZ-7kW9WGAbsFWQW3YT1iKqIA,4314
+NEMO_billing/prepayments/migrations/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+NEMO_billing/prepayments/views/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+NEMO_billing/prepayments/views/prepayments.py,sha256=NqlEoHwOhqCnqYnvnuFAJiz1APHhEY_ruGsKRXp9dGs,2763
 NEMO_billing/rates/__init__.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
 NEMO_billing/rates/admin.py,sha256=PLyXJ4-y8kit8yLHbqawYz0g7dgg9Zkkn6f9qepcl3I,8271
 NEMO_billing/rates/api.py,sha256=cOycY3KCEY6DexNjxn0WQmVrBMQHviMqnTFzz7pE-qk,2318
 NEMO_billing/rates/app_settings.py,sha256=G5GkjK908YTclKp4Q74OD1LAck5ouKZgjpl3KyNmJZU,100
-NEMO_billing/rates/apps.py,sha256=FDnwXQdn2-yUyr8bjBLt66EbLwTqf8ipvlk0xBqjNpg,707
+NEMO_billing/rates/apps.py,sha256=Lnb7XBu8KU0YvS8rdxJRpCawkapBmEiHvUzwTsLhPcI,715
 NEMO_billing/rates/customization.py,sha256=DDlApUw8eW5uRFFh0-y1oxOvjWo9LqT_cjrxYD69P3E,520
 NEMO_billing/rates/model_diff.py,sha256=8IJZDf3694tpn3RAn0g2DyGXBjN0OSTLqpNTmWZtvKk,1913
 NEMO_billing/rates/models.py,sha256=uYPqPjalnVPiB1xdMh58JZhmANtXbW-1KINs36swTAo,22892
 NEMO_billing/rates/rates_class.py,sha256=GQ9t2AtRVlMH447UdEBzxYHA2NO_FHaVTrfvD7Y32fk,4042
 NEMO_billing/rates/urls.py,sha256=Z-MTa59AzWyBceFjhVIGIj2A7s-O7R8aG6XW3rA49wI,838
 NEMO_billing/rates/views.py,sha256=DvEOMJPGOjC_ARprfFZZg7_Oo9K7_grkNllC1_HL4OU,12483
 NEMO_billing/rates/migrations/0001_initial.py,sha256=Sz5S5PVnYxoOA4Iw4AJbg3Xg-iTwzRHCyMz7wEny5xI,5101
@@ -100,32 +113,35 @@
 NEMO_billing/rates/static/rates/rates.css,sha256=PcSgA1klrSnF43In82rbVYkS3KUthQKOy9qP10dry0E,81
 NEMO_billing/rates/templates/customizations/customizations_billing_rates.html,sha256=ZB7R21fG6nSWrEnpv82-IFzIe2kyCTzEtrj8qO1mYVI,1808
 NEMO_billing/rates/templates/rates/base.html,sha256=v36mGGC10oJjSMScGg0WqUJzKOlJe1Bp3444noFGgIo,160
 NEMO_billing/rates/templates/rates/rate.html,sha256=jFEbwDE6oSQUWfm7Jhw97SnjtjxF7t5F5zM6Tnw2qGc,6047
 NEMO_billing/rates/templates/rates/rate_form_details.html,sha256=F7Im8Y5jBHTDSlnf4EuH-lHwxShFAlNlG53ZQx1vhDM,5591
 NEMO_billing/rates/templates/rates/rates.html,sha256=7uRELddWPU37iwSWzIEFT4irJoS785IsfOk59cY0wzQ,4602
 NEMO_billing/templates/base/navbar.html,sha256=2MD4PEQrn0J4RKBFdeSuyQUcolGi-s_G4u4H5PacRCk,192
-NEMO_billing/templates/base/navbar_billing.html,sha256=y3ie0hEPeKCLC8uVuWYcmzLXrMzLA8fs9M17OPLJnzY,461
+NEMO_billing/templates/base/navbar_billing.html,sha256=7Fo-_HZCpiMQCr1BvMU2xEfOeZeZrSZ_Lh6FMYiapv0,1065
+NEMO_billing/templates/billing/cap_and_prepaid_base.html,sha256=ykUs3YgBEBMAo7gU4ZzixBWyu3bw5XFAHgjJ5YlaehM,1162
 NEMO_billing/templates/billing/custom_charge.html,sha256=mLQX6GQtMaVbhKxqoepm-y-cokpDByaG_U5P-DNI58Q,8882
 NEMO_billing/templates/billing/custom_charges.html,sha256=isMdty7a1D576tjMQEDHE0wrnV68t8nFZbmN2WqJ2-M,2074
 NEMO_billing/templates/staff_charges/choose_project.html,sha256=dPh8PJKri4LNbtUDqmy3y34xJfvs6FRo3t5ZQT1gH-E,1259
 NEMO_billing/templates/staff_charges/new_custom_staff_charge.html,sha256=q73pThu5W7XNPMtPax3fg39qGnE_OPPcjes3R9kfc9c,1979
 NEMO_billing/templatetags/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/templatetags/billing_tags.py,sha256=OR-x57lClBU__1iYviKmTHPQVNqfqjlxTdLLSUrw3Pg,1013
 NEMO_billing/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/tests/test_settings.py,sha256=AVuDAFQNICeCV-Zt8cDaa8_3Hi8xEkQHSFjYrAS2PVU,3047
+NEMO_billing/tests/test_settings.py,sha256=2rjncQ_9NOKOT6HMUkznXVVWqCuNLFyCDSDTguSnE5U,3079
 NEMO_billing/tests/test_urls.py,sha256=ZT1Q-7KU38x5J5QdxFqWYaXCVj8SrhZQ0WzkFDVs7Q8,1472
 NEMO_billing/tests/test_utilities.py,sha256=NFDLpizSngSpJf-yNb-TnEX1HyNKgY8x1E29PL8tSWA,1094
 NEMO_billing/tests/cap/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-NEMO_billing/tests/cap/test_cap_discount.py,sha256=LjB1MNoMsBSqCAm_pu1KgvJuWqP9pjuAmqA_xluWY_Q,19469
+NEMO_billing/tests/cap/test_cap_discount.py,sha256=4NZbrPrihXBTw9085cmZGUfHuhihQkNcHnbndu7c9nI,19521
 NEMO_billing/tests/cap/test_cap_invoicing.py,sha256=4MJoAWvoULR6_At9VznqUBoSQvaarQxGHrQQxJO47kE,32811
-NEMO_billing/tests/cap/test_cap_utilities.py,sha256=rQOpoB16ysmPJ1w36N1M-4eFF--EYp0kiwRLIoFIJrI,4252
+NEMO_billing/tests/cap/test_cap_utilities.py,sha256=Sn2-L9pzSrYDhAVEk2D3outwcgQhBBhSNqKbbbkrnr8,4271
+NEMO_billing/tests/prepayments/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
+NEMO_billing/tests/prepayments/test_prepayments.py,sha256=QZh2B-5DwUGnKhEUasvTM-a9vrNVpDILJsmJsOIpWKI,14410
 NEMO_billing/tests/rates/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 NEMO_billing/tests/rates/test_rate_amount.py,sha256=ebFt4ewtTYgG43QMp8kMuwyuIRaBaK-A9UeqJqbiJGA,33260
 NEMO_billing/tests/rates/test_rate_time.py,sha256=HlFPppN2ArI2wtIOCiAbn4Vdi0soy0U0luKiw7v-Xek,20895
 NEMO_billing/tests/rates/test_rate_uniqueness.py,sha256=73HgpjHMVhjNVFQkET4LTmisI0sMbQXcbh6t1F2vH9Q,6164
 NEMO_billing/tests/rates/test_split_billables.py,sha256=BJxjVoiAG-85Ii731RoQ7d5iGzOIxk8lv4Vl46KAMnY,27008
-NEMO_billing-2.4.0.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
-NEMO_billing-2.4.0.dist-info/METADATA,sha256=dDZAX8cT1EBIc1QqWHt0P-z_A14Z7GNZIb5OvCePC48,5343
-NEMO_billing-2.4.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-NEMO_billing-2.4.0.dist-info/top_level.txt,sha256=oSVD1wly89TarvuLJtW0tkI41vVO_BaZ7EuxPtyp9qo,13
-NEMO_billing-2.4.0.dist-info/RECORD,,
+NEMO_billing-2.5.0.dist-info/LICENSE,sha256=wFCCmLGvBMU6-W_0h08WYEs3cFtVstutDmY5AzKppQc,1074
+NEMO_billing-2.5.0.dist-info/METADATA,sha256=peek7GPLKMOmV6JL_ZAz4D15gBcs3NIXcGNouRehEyM,5343
+NEMO_billing-2.5.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+NEMO_billing-2.5.0.dist-info/top_level.txt,sha256=oSVD1wly89TarvuLJtW0tkI41vVO_BaZ7EuxPtyp9qo,13
+NEMO_billing-2.5.0.dist-info/RECORD,,
```

